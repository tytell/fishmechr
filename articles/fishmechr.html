<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>fishmechr • fishmechr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="fishmechr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fishmechr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/fishmechr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/prickleback_swimming.html">prickleback_swimming</a></li>
    <li><a class="dropdown-item" href="../articles/process_sleap_data.html">process_sleap_data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>fishmechr</h1>
            
      

      <div class="d-none name"><code>fishmechr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tytell.github.io/fishmechr/">fishmechr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'dplyr::filter' by 'gsignal::filter' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::conv' by 'pracma::conv' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::ifftshift' by 'pracma::ifftshift'</span></span>
<span><span class="co">#&gt; when loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::findpeaks' by 'pracma::findpeaks'</span></span>
<span><span class="co">#&gt; when loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::fftshift' by 'pracma::fftshift'</span></span>
<span><span class="co">#&gt; when loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::ifft' by 'pracma::ifft' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::detrend' by 'pracma::detrend' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fishmechr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     deriv</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="computing-kinematic-parameters">Computing kinematic parameters<a class="anchor" aria-label="anchor" href="#computing-kinematic-parameters"></a>
</h2>
<p>To compute midline swimming kinematics accurately, follow the steps
below.</p>
<ol style="list-style-type: decimal">
<li>Compute the arc length along the curve of the body.</li>
<li>If the points are not consistently at the same arc length,
interpolate the points so that each one is at a consistent point on the
body. It is often useful to do some smoothing as part of this step.</li>
<li>Compute a center location. Ideally this is the center of mass, but
it could be approximated in a variety of ways.</li>
<li>Compute the body curvature or excursion relative to a central axis,
or both.</li>
<li>Estimate the phase of the oscillation at each point. You can either
detect peaks and zero crossings or use a mathematical technique called
the Hilbert transform.</li>
<li>Use temporal and spatial derivatives of the phase to estimate the
oscillation frequency, body wavelength, and body wave speed.</li>
<li>Based on the phase, identify individual undulation cycles. Within
each cycle, you can identify the range of body excursion or curvature to
compute the amplitude.</li>
</ol>
<div class="section level3">
<h3 id="compute-arc-length">1. Compute arc length<a class="anchor" aria-label="anchor" href="#compute-arc-length"></a>
</h3>
<p>Most kinematic variables are best specified in terms of arc length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
the distance along the body from the head to a particular point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mo stretchy="true" form="prefix">[</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>y</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><msub><mi>s</mi><mn>1</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex"> s_i = \sum_{j=1}^{i-1} \left[ (x_{j+1} - x_{j})^2 + (y_{j+1} - y_{j})^2 \right], s_1 = 0 </annotation></semantics></math>
Using arc length is better than something like the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
coordinate for two reasons. First, often a fish does not swim precisely
along the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
axis, which means that the points would need to be rotated. Second, many
fish swim with relatively large amplitude motions, which means that the
distance along the curve is larger than the distance along the swimming
direction, particularly near the tail where amplitudes are higher.</p>
</div>
<div class="section level3">
<h3 id="interpolate-points-for-a-consistent-position">2. Interpolate points for a consistent position<a class="anchor" aria-label="anchor" href="#interpolate-points-for-a-consistent-position"></a>
</h3>
<p>Ideally, we want each point to represent a consistent location on the
fish’s body. Particularly with fish that do not have clear landmarks
along the body, we may be able to mark the middle easily between the
left and right side, but at points that may not be consistent along the
fish’s length. We can use a spline to interpolate points at a consistent
location.</p>
<p>Digitized points often have some error. As part of the interpolation
process, we can use a smoothing spline to smooth out some of that
error.</p>
</div>
<div class="section level3">
<h3 id="estimate-a-center-location">3. Estimate a center location<a class="anchor" aria-label="anchor" href="#estimate-a-center-location"></a>
</h3>
<p>The center location is a weighted average location. For a midline
defined by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
coordinates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_i, y_i)</annotation></semantics></math>,
there are four main ways to identify the center location.</p>
<ol style="list-style-type: decimal">
<li><p>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mi>i</mi></msub><annotation encoding="application/x-tex">m_i</annotation></semantics></math>
is the mass of segment located between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_i, y_i)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_{i+1}, y_{i+1})</annotation></semantics></math>,
then
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>M</mi></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><msub><mi>m</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> x_{com} = \frac{1}{2 M} \sum_{i=1}^{n-1} m_i \left( x_{i+1} + x_i \right)  </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>M</mi></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><msub><mi>m</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> y_{com} = \frac{1}{2 M} \sum_{i=1}^{n-1} m_i \left( y_{i+1} + y_i \right)  </annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
is the total mass of the fish. If you know the mass distribution but not
the true masses of segments, you could also use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mi>i</mi></msub><annotation encoding="application/x-tex">m_i</annotation></semantics></math>
as the fraction of the total mass in segment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
would be 1.</p></li>
<li><p>If you do not know the mass distribution, then you can
approximate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mi>i</mi></msub><annotation encoding="application/x-tex">m_i</annotation></semantics></math>
in several ways. The best is to use the width and height of the body. If
the body, without the fins, has an elliptical cross section, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>i</mi></msub><annotation encoding="application/x-tex">w_i</annotation></semantics></math>
is the horizontal width and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>h</mi><mi>i</mi></msub><annotation encoding="application/x-tex">h_i</annotation></semantics></math>
is the dorso-ventral height at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
then the volume of the segment from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_i, y_i)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_{i+1}, y_{i+1})</annotation></semantics></math>
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>i</mi></msub><mo>=</mo><mi>π</mi><mi>Δ</mi><msub><mi>s</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>w</mi><mi>i</mi></msub><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><mfrac displaystyle="false"><mn>1</mn><mn>2</mn></mfrac><mi>Δ</mi><msub><mi>w</mi><mi>i</mi></msub><msub><mi>h</mi><mi>i</mi></msub><mo>+</mo><mfrac displaystyle="false"><mn>1</mn><mn>2</mn></mfrac><mi>Δ</mi><msub><mi>h</mi><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo>+</mo><mfrac displaystyle="false"><mn>1</mn><mn>3</mn></mfrac><mi>Δ</mi><msub><mi>w</mi><mi>i</mi></msub><mi>Δ</mi><msub><mi>h</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> V_i = \pi \Delta s_i \left( w_i h_i + \tfrac{1}{2} \Delta w_i h_i +
\tfrac{1}{2} \Delta h_i w_i + \tfrac{1}{3} \Delta w_i \Delta h_i \right)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><msub><mi>s</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Delta s_i = s_{i+1} - s_i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>w</mi><mi>i</mi></msub><mo>=</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Delta w_i = w_{i+1} - w_i</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>h</mi><mi>i</mi></msub><mo>=</mo><msub><mi>h</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Delta h_i = h_{i+1} - h_i</annotation></semantics></math>.
Then we approximate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>i</mi></msub><mo>≈</mo><mi>ρ</mi><msub><mi>V</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">m_i \approx \rho V_i</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
is the density of the fish, which we assume here to be constant, so that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>V</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>2</mn><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><msub><mi>V</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> x_{com} = \frac{\sum_{i=1}^{n-1} \left[ V_i \left( x_{i+1} + x_i \right) \right] } 
{ 2 \sum_{i=1}^{n-1} V_i } </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>V</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>2</mn><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><msub><mi>V</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> y_{com} = \frac{\sum_{i=1}^{n-1} \left[ V_i \left( y_{i+1} + y_i \right) \right] } 
{ 2 \sum_{i=1}^{n-1} V_i } </annotation></semantics></math></p></li>
<li><p>Often the width is visible from a camera from above or below, but
the height is not known. In this case, a reasonable approximation (at
least for elongate fishes where the height does not vary too much) is
that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>i</mi></msub><mo>∝</mo><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">m_i \propto w_i</annotation></semantics></math>,
so that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub></mrow><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> x_{com} = \frac{\sum_{i=1}^{n} w_i x_i}{\sum_{i=1}^{n} w_i} </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><msub><mi>y</mi><mi>i</mi></msub></mrow><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> y_{com} = \frac{\sum_{i=1}^{n} w_i y_i}{\sum_{i=1}^{n} w_i} </annotation></semantics></math></p></li>
<li><p>Choose one point along the body to use as the center. This could
be the snout or a point close to the center of mass. This has been
called the “stretched-straight center of mass”, but tends to give
inaccurate estimates of velocity or acceleration.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="estimate-curvature-or-lateral-excursion">4. Estimate curvature or lateral excursion<a class="anchor" aria-label="anchor" href="#estimate-curvature-or-lateral-excursion"></a>
</h3>
<div class="section level4">
<h4 id="curvature">Curvature<a class="anchor" aria-label="anchor" href="#curvature"></a>
</h4>
<p>The 2D curvature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>κ</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
of the midline in the horizontal plane is often a useful variable to
compute. In particular, it is usually proportional to the muscle strain
at that point on the body (Shadwick 1998, Katz 1999). In contrast, the
lateral excursion of the body is not usually a good estimate of muscle
strain (Shadwick 1998).</p>
<p>Mathematically, curvature can be thought of in two different ways.
First, it is the inverse of the radius of curvature: the radius of a
circle drawn through three successive points. The smaller the radius of
curvature, the sharper the body bend, and the larger the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>κ</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>.
This estimate for curvature is defined by the following equation
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>κ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mrow><mi>∂</mi><mi>x</mi></mrow><mrow><mi>∂</mi><mi>s</mi></mrow></mfrac><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mi>y</mi></mrow><mrow><mi>∂</mi><msup><mi>s</mi><mn>2</mn></msup></mrow></mfrac><mo>−</mo><mfrac><mrow><mi>∂</mi><mi>y</mi></mrow><mrow><mi>∂</mi><mi>s</mi></mrow></mfrac><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mi>x</mi></mrow><mrow><mi>∂</mi><msup><mi>s</mi><mn>2</mn></msup></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">[</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>∂</mi><mi>x</mi></mrow><mrow><mi>∂</mi><mi>s</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>∂</mi><mi>y</mi></mrow><mrow><mi>∂</mi><mi>s</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>3</mn><mi>/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex"> \kappa = \left[ \frac{\partial x}{\partial s} \frac{\partial^2 y}{\partial s^2} - \frac{\partial y}{\partial s} \frac{\partial^2 x}{\partial s^2} \right] \left[ \left( \frac{\partial x}{\partial s} \right)^2 + \left( \frac{\partial y}{\partial s} \right)^2 \right]^{-3/2} </annotation></semantics></math></p>
<p>Second, it is the spatial derivative of the angle of each segment. If
a segment at arc length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
has an angle
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
to the horizontal axis, then the curvature is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>κ</mi><mo>=</mo><mfrac><mrow><mi>∂</mi><mi>θ</mi></mrow><mrow><mi>∂</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \kappa = \frac{\partial \theta}{\partial s} </annotation></semantics></math>
The angle for segment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>i</mi></msub><mo>=</mo><msup><mo>tan</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_i = \tan^{-1}(y_{i+1} - y_i, x_{i+1} - x_i)</annotation></semantics></math>.</p>
<p>Although both formulas are mathematically equivalent, they have
slightly different properties depending on the measurement error on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
positions.</p>
</div>
<div class="section level4">
<h4 id="lateral-excursion">Lateral excursion<a class="anchor" aria-label="anchor" href="#lateral-excursion"></a>
</h4>
<p>One can also estimate the body phase, and then the wavelength and
wave speed, based on the excursion of the body relative to a primary
axis. We suggest using the singular value decomposition (SVD) to
estimate the primary axis, then using a low-pass filter to remove any
oscillations at the tail beat frequency or higher. If you have a matrix
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
coordinates of points along the body at a specific time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐗</mi><mrow><mi>n</mi><mo>×</mo><mn>2</mn></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mi>n</mi></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mi>n</mi></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{X}_{n\times2} = 
\begin{pmatrix} 
x_1 &amp; y_1 \\
x_2 &amp; y_2 \\
\vdots &amp; \vdots \\
x_n &amp; y_n
\end{pmatrix} </annotation></semantics></math> where the subscript
indicates the size of the matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
points along the body by 2).</p>
<p>First, center each axis by subtracting the location of the center of
mass or the mean of each column, to produce a matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>𝐗</mi><mi>𝐂</mi></msup><annotation encoding="application/x-tex">\mathbf{X^C}</annotation></semantics></math>,
centered around 0. Then the singular value decomposition allows you to
write the matrix in the form
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>𝐗</mi><mrow><mi>n</mi><mo>×</mo><mn>2</mn></mrow><mi>C</mi></msubsup><mo>=</mo><msub><mi>𝐔</mi><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></msub><msub><mi>𝚺</mi><mrow><mi>n</mi><mo>×</mo><mn>2</mn></mrow></msub><msubsup><mi>𝐕</mi><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><mi>T</mi></msubsup><mi>.</mi></mrow><annotation encoding="application/x-tex"> \mathbf{X}^C_{n\times2} = \mathbf{U}_{n\times n} \mathbf{\Sigma}_{n \times 2} \mathbf{V}_{2 \times 2}^T. </annotation></semantics></math>
The matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐕</mi><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">\mathbf{V}_{2 \times 2}</annotation></semantics></math>
then represents the principal axes of the body in that frame. The matrix
can be estimated at each time point, to produce a time-varying matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐕</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{V}(t)</annotation></semantics></math>.</p>
<p>Assuming the amplitude is relatively small, the first column of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐕</mi><annotation encoding="application/x-tex">\mathbf{V}</annotation></semantics></math>
represents a unit vector pointing along the primary axis of the body
(which we call
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>𝐚</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{\hat{a}}(t)</annotation></semantics></math>
and the second column is a unit vector normal to the primary axis.</p>
<p>We suggest using a low pass filter with a cutoff frequency below the
tail beat frequency to smooth the components of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>𝐚</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{\hat{a}}(t)</annotation></semantics></math>
vector, making sure to normalize it after smoothing. See implementation
details below.</p>
</div>
</div>
<div class="section level3">
<h3 id="estimate-phase">5. Estimate phase<a class="anchor" aria-label="anchor" href="#estimate-phase"></a>
</h3>
<p>To estimate the undulation frequency, body wavelength, and wave
speed, consider a simple equation for the midline. Fish swim using a
traveling wave of curvature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>s</mi></msub><annotation encoding="application/x-tex">\kappa_s</annotation></semantics></math>
(or lateral excursion) defined at an arc length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
along the body as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>κ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>A</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>cos</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mi>s</mi><mi>λ</mi></mfrac><mo>−</mo><mi>f</mi><mi>t</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\kappa(s, t) = A(s) \cos\left(2\pi \left[ \frac{s}{\lambda} - f t \right] \right) 
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">A(s)</annotation></semantics></math>
is the wave amplitude,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
is the wave length,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
is the oscillation frequency, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is time. In this case, the phase of the oscillation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\phi(s, t)</annotation></semantics></math>
at a particular point along the body is approximately equal to the
argument of the cosine,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mi>/</mi><mi>λ</mi><mo>−</mo><mi>f</mi><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">2\pi \left( s / \lambda - f t \right)</annotation></semantics></math>.
If the amplitude
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
varies over quickly over time or space, this approximation may not be
exactly correct.</p>
<p>If we can estimate the phase accurately, then we can use a spatial
(i.e., with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>)
or temporal derivative to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,
the body wavelength, or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
the undulation frequency.</p>
<p>Below, we describe two methods for estimating phase. Before using
either of these two methods, it may be helpful to add a second smoothing
step, which may even oversmooth the data. Both of the methods require
signals that oscillate around zero and clear peaks. If the oscillations
are offset from zero, or there is noise in the data (particularly if
there are noisy oscillations near the peaks that make it seem that there
are multiple peaks), they will not give good results.</p>
<div class="section level4">
<h4 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h4>
<p>Here, we suggest using a bandpass filter on the oscillation of any
individual point. Choose a lower frequency that is less than half the
lowest oscillation frequency and an upper frequency that is about 5-10
times the highest oscillation frequency. The low frequency may be quite
low. Be careful using standard filter design functions (such as the
<code>butter</code> function in <code>pracma</code>) because these
functions use autoregressive moving averages, which do not perform well
for filtering at very low frequencies. We recommend using the “second
order sections” method, which is more numerically stable. See further
details below.</p>
<p>Note that these (over) smoothed results are good to use for
estimating phase, but not for later estimates of tailbeat amplitude or
excursion.</p>
</div>
<div class="section level4">
<h4 id="use-the-hilbert-transform">Use the Hilbert transform<a class="anchor" aria-label="anchor" href="#use-the-hilbert-transform"></a>
</h4>
<p>One convenient and relatively robust way to estimate the phase of
each body point involves the use of the Hilbert transform
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐇</mi><annotation encoding="application/x-tex">\mathbf{H}</annotation></semantics></math>,
a procedure that uses the Fourier transform to estimate a periodic
signal that is 90deg shifted relative to another. In essence, given a
cosine signal, the Hilbert transform returns the sine with the same
amplitude and frequency. The utility of this operation is that it lets
us estimate the ``analytic signal’’, a complex-valued signal where the
magnitude of the complex number is the amplitude of the wave and the
phase angle of the complex number is the phase of the signal.</p>
<p>We can then take the Hilbert transform to estimate the analytic
signal for curvature or lateral excursion
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>κ</mi><mo>*</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>κ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>i</mi><mi>𝐇</mi><mo stretchy="false" form="prefix">{</mo><mi>κ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\kappa^*(s, t) = \kappa(s, t) + i \mathbf{H}\{\kappa(s, t)\}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is the imaginary number. (Note that the <code>hilbert</code> function in
R and Python returns the full analytic signal, not just the imaginary
component as written above). For a complex number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mi>a</mi><mo>+</mo><mi>i</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">C = a + ib</annotation></semantics></math>,
the magnitude is denoted by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mi>/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">||C|| = \left[ a^2 + b^2 \right]^{1/2}</annotation></semantics></math>
and the phase angle is denoted by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>∠</mi><mi>C</mi><mo>=</mo><msup><mo>tan</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mi>/</mi><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\angle C = \tan^{-1} (b / a)</annotation></semantics></math>.</p>
<p>One can also estimate the analytic signal for the lateral excursion
of the body
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(s, t)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
is the lateral position of a point on the body, relative to the overall
axis of the body. We suggest using the singular value decomposition to
estimate the central body axis and then using a low-pass filter with a
cutoff frequency lower than the tail beat frequency to remove the tail
beat oscillation, as described above.</p>
<p>The analytic signal thus provides an estimate of the phase can be
estimated as a continuous function of both time and position along the
body. Other techniques for estimating phase require identifying
particular features in the signal (such as peaks or zero crossings) and
therefore do not estimate phase as a continuous signal. The estimated
phase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\phi}</annotation></semantics></math>
is thus
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>∠</mi><msup><mi>κ</mi><mo>*</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\hat{\phi}(s, t) = \angle \kappa^*(s, t).</annotation></semantics></math>
For a traveling wave, this phase, as estimated here, is equal to the
argument of the cosine function from the traveling wave equation above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2</mn><mi>π</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>s</mi><mi>/</mi><mi>λ</mi><mo>−</mo><mi>f</mi><mi>t</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\phi}(s, t) = 2\pi [s/\lambda - f t]</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="numerical-considerations-for-the-hilbert-transform">Numerical considerations for the Hilbert transform<a class="anchor" aria-label="anchor" href="#numerical-considerations-for-the-hilbert-transform"></a>
</h4>
<p>The Hilbert transform only works well for this analysis with signals
that are centered around zero and consist of many relatively smooth
tailbeats. This is why we suggest using the curvature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>κ</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>,
rather than something like lateral position or the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
coordinate of the body. To use the Hilbert transform on a lateral
position, it is important to subtract a baseline value or use a high
pass filter to ensure that the signal is centered around zero.</p>
<p>Similarly, if the signal is noisy, the phase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\phi}</annotation></semantics></math>
will not increase steadily and the derivatives used to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>f</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{f}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>λ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\lambda}</annotation></semantics></math>
will not be meaningful. It is best to filter the input signal using a
bandpass or low pass filter so that the oscillations are smooth.</p>
<p>In most programming languages, one should use a function
<code>atan2</code> to estimate phase (not <code>atan</code>), because it
gives an angle that ranges around the full circle (rather than 0 to 180
degrees). However, the output of <code>atan2</code> will jump (usually
from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">-\pi</annotation></semantics></math>)
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
increase. To estimate frequency or wavelength, before performing the
derivatives, one should estimate a smoothly increasing phase using a
function <code>unwrap</code>, which searches for jumps and removes
them.</p>
</div>
<div class="section level4">
<h4 id="detect-peaks-and-zero-crossings">Detect peaks and zero crossings<a class="anchor" aria-label="anchor" href="#detect-peaks-and-zero-crossings"></a>
</h4>
<p>We can also estimate a phase by detecting specific features in the
oscillation, such as peaks or zero crossings, and then interpolating a
continuous value for the phase using a spline curve. For a cosine
function, as above, a positive peak has phase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\hat{\phi} = 0</annotation></semantics></math>,
a downward zero crossing has phase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\pi/2</annotation></semantics></math>,
a negative peak (i.e., a trough) has phase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>,
and an upward zero crossing has phase
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mi>π</mi><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">3\pi/2</annotation></semantics></math>.
By identifying these features and their corresponding phases, one can
then interpolate a continuous phase.</p>
<p>Using this method requires careful error checking. In particular,
peaks can be identified erroneously, particularly if there is noise in
the signal. We recommend using a strong smoothing filter on the
curvature or lateral excursion before estimating phase. See examples and
numerical details below.</p>
</div>
</div>
<div class="section level3">
<h3 id="use-the-phase-to-estimate-frequency-and-wavelength">6. Use the phase to estimate frequency and wavelength<a class="anchor" aria-label="anchor" href="#use-the-phase-to-estimate-frequency-and-wavelength"></a>
</h3>
<p>We can then use the estimated phase to compute the frequency and
wavelength by taking derivatives in time or space, respectively,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>π</mi></mrow></mfrac><mfrac><mi>∂</mi><mrow><mi>∂</mi><mi>t</mi></mrow></mfrac><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{f}(t) = \frac{1}{2\pi} \frac{\partial}{\partial t} \hat{\phi}(s,t)</annotation></semantics></math>
Estimated this way, frequency should be the same at every point along
the body. Therefore, you can average
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>f</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{f}</annotation></semantics></math>
across the body or choose a single point along the body (usually the
tail) to use as the estimate of frequency.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mi>s</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2</mn><mi>π</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>∂</mi><mrow><mi>∂</mi><mi>s</mi></mrow></mfrac><mover><mi>ϕ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\hat{\lambda}_s(t) = 2 \pi \left( \frac{\partial}{\partial s} \hat{\phi}(s,t) \right)^{-1}</annotation></semantics></math></p>
<p>The body wave speed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>V</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{V}</annotation></semantics></math>
is the product of the two:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>V</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mover><mi>λ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>f</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{V}(t) = \hat{\lambda}(s, t) \hat{f}(t)</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="quantify-swimming-parameters-on-a-cycle-by-cycle-basis">7. Quantify swimming parameters on a cycle-by-cycle basis<a class="anchor" aria-label="anchor" href="#quantify-swimming-parameters-on-a-cycle-by-cycle-basis"></a>
</h3>
<p>Once you have estimated a good undulation phase, it is
straightforward to quantify other parameters that vary every cycle.
Usually, we need to define an overall phase of the entire body
oscillation. It’s best to choose the most reliable phase estimate, which
is usually the phase of the tail tip or a point near the tail (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mrow><mi>p</mi><mi>h</mi><mi>i</mi></mrow><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{phi}(L, t)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
is the body length).</p>
<p>As phase increases past
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">2\pi</annotation></semantics></math>,
it will jump back to 0. Most programming languages have a functioned
called <code>unwrap</code> that looks for those jumps and removes them,
producing a steadily increasing phase, which we will refer to as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Φ</mi><mo accent="true">̂</mo></mover><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\Phi}_c(t)</annotation></semantics></math>.
Then the cycle number is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">⌊</mo><msub><mover><mi>Φ</mi><mo accent="true">̂</mo></mover><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">⌋</mo></mrow></mrow><annotation encoding="application/x-tex"> C(t) = \left\lfloor\hat{\Phi}_c(t) / (2\pi) \right\rfloor </annotation></semantics></math>
where the L brackets denote the <code>floor</code> operation, or
rounding down to the next lowest integer value.</p>
<p>For example, to find the body amplitude, search within each cycle to
find the range of motion for each body point, and divide by two. See
details below.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-analysis-of-a-lamprey-data-set">Example analysis of a lamprey data set<a class="anchor" aria-label="anchor" href="#example-analysis-of-a-lamprey-data-set"></a>
</h2>
<div class="section level3">
<h3 id="data-structure">Data structure<a class="anchor" aria-label="anchor" href="#data-structure"></a>
</h3>
<p>The data set <code>lampreydata</code> is included in the
<code>fishmechr</code> package. Most swimming kinematics data sets
should have a similar structure:</p>
<ul>
<li>A time or frame column. It’s often good to keep both in the data
set. (Here, these are in <code>t</code> and <code>frame</code>)</li>
<li>A column that identifies the point on the body. This could be a
factor variable, with names of each body part (like returned by Sleap or
DeepLabCut), as long as there is a clear order from head to tail. Or it
could be a numeric variable, with points numbered from 1 to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
where 1 is the snout and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is the tail. (here this is in <code>point</code>).</li>
<li>x and y coordinates of the point. Currently, these algorithms are
only designed to work on 2D movements in the horizontal plane. (here
these are in <code>mxmm</code> and <code>mymm</code>, indicating
“midline” x and y points in mm)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lampreydata</span><span class="op">)</span></span>
<span><span class="co">#&gt;      t frame point mxmm mymm</span></span>
<span><span class="co">#&gt; 1 0.02     1     1   NA   NA</span></span>
<span><span class="co">#&gt; 2 0.02     1     2   NA   NA</span></span>
<span><span class="co">#&gt; 3 0.02     1     3   NA   NA</span></span>
<span><span class="co">#&gt; 4 0.02     1     4   NA   NA</span></span>
<span><span class="co">#&gt; 5 0.02     1     5   NA   NA</span></span>
<span><span class="co">#&gt; 6 0.02     1     6   NA   NA</span></span></code></pre></div>
<p>This plot shows the midlines in two frames.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mxmm</span>, <span class="va">mymm</span>, color <span class="op">=</span> <span class="va">frame</span>, group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="kinematics-process">Kinematics process<a class="anchor" aria-label="anchor" href="#kinematics-process"></a>
</h2>
<div class="section level3">
<h3 id="compute-arc-length-1">Compute arc length<a class="anchor" aria-label="anchor" href="#compute-arc-length-1"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>arclen0 <span class="op">=</span> <span class="fu"><a href="../reference/arclength.html">arclength</a></span><span class="op">(</span><span class="va">mxmm</span>, <span class="va">mymm</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Here we plot the arc length of a few points along the body. We can
see that they’re generally in the same location, but not exactly, so
we’ll need to interpolate so that they’re in the same place.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">arclen0</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-5-1.png" width="700">
Here’s the interpolation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span> <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/interpolate_points_df.html">interpolate_points_df</a></span><span class="op">(</span><span class="va">arclen0</span>, <span class="va">mxmm</span>, <span class="va">mymm</span>, spar <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                        tailmethod <span class="op">=</span> <span class="st">'extrapolate'</span>,</span>
<span>                        .out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>arclen<span class="op">=</span><span class="st">'arclen'</span>, xs<span class="op">=</span><span class="st">'mxmm_s'</span>, ys<span class="op">=</span><span class="st">'mymm_s'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now the points are always at the same arc length. Sometimes this
requires extrapolating to get the tail position.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mxmm</span>, <span class="va">mymm</span>, color <span class="op">=</span> <span class="va">frame</span>, group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mxmm_s</span>, y <span class="op">=</span> <span class="va">mymm_s</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="get-the-width">Get the width<a class="anchor" aria-label="anchor" href="#get-the-width"></a>
</h3>
<p>I have digitized the width of an ammocoete from the ventral view. We
assume here that the width is the distance from one lateral edge to the
other (like a diameter), not the distance from the center to an edge
(like a radius). Here it’s expressed in terms of body lengths, both
along the body and for the width itself.</p>
<p>Initially, the width is in a separate data frame. It should have a
column for arclength (here, <code>s</code>) and a column for width. This
one has columns for eels and ammocoetes. It’s simplest if <code>s</code>
and width are both normalized relative to body length (so <code>s</code>
should range from 0 to 1, and width should be around 0.05-0.1 BL for
most fishes).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishwidth</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 3</span></span></span>
<span><span class="co">#&gt;         s eelwidth ammowidth</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0        0.018<span style="text-decoration: underline;">1</span> 0.016<span style="text-decoration: underline;">0</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.052<span style="text-decoration: underline;">6</span>   0.039<span style="text-decoration: underline;">4</span> 0.016<span style="text-decoration: underline;">9</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.105    0.050<span style="text-decoration: underline;">1</span> 0.017<span style="text-decoration: underline;">8</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.158    0.035<span style="text-decoration: underline;">6</span> 0.018<span style="text-decoration: underline;">2</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.211    0.038<span style="text-decoration: underline;">0</span> 0.018<span style="text-decoration: underline;">3</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.263    0.039<span style="text-decoration: underline;">7</span> 0.018<span style="text-decoration: underline;">5</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.316    0.040<span style="text-decoration: underline;">3</span> 0.018<span style="text-decoration: underline;">6</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.368    0.039<span style="text-decoration: underline;">7</span> 0.018<span style="text-decoration: underline;">1</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.421    0.039<span style="text-decoration: underline;">8</span> 0.017<span style="text-decoration: underline;">5</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.474    0.038<span style="text-decoration: underline;">6</span> 0.016<span style="text-decoration: underline;">9</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 0.526    0.036<span style="text-decoration: underline;">7</span> 0.015<span style="text-decoration: underline;">9</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 0.579    0.035<span style="text-decoration: underline;">8</span> 0.014<span style="text-decoration: underline;">9</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 0.632    0.033<span style="text-decoration: underline;">9</span> 0.013<span style="text-decoration: underline;">8</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 0.684    0.032<span style="text-decoration: underline;">2</span> 0.012<span style="text-decoration: underline;">7</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 0.737    0.029<span style="text-decoration: underline;">5</span> 0.011<span style="text-decoration: underline;">2</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 0.789    0.026<span style="text-decoration: underline;">4</span> 0.009<span style="text-decoration: underline;">77</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 0.842    0.024<span style="text-decoration: underline;">6</span> 0.008<span style="text-decoration: underline;">23</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 0.895    0.021<span style="text-decoration: underline;">7</span> 0.005<span style="text-decoration: underline;">97</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 0.947    0.013<span style="text-decoration: underline;">9</span> 0.003<span style="text-decoration: underline;">71</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> 1        0      0.000<span style="text-decoration: underline;">087</span>5</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fishwidth</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s</span>, y <span class="op">=</span> <span class="va">ammowidth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Arc length (BL)'</span>, y <span class="op">=</span> <span class="st">'Width (BL)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Here, we interpolated the width from the separate data frame so that
it’s defined at the right arc lengths for our lamprey data set.
<code>interpolate_width</code> assumes that <code>arclen</code> is in
real units (like cm) and goes from the head to the tip of the tail, so
that the last value represents the total length of the fish. Once the
width is interpolated at the new arc lengths, it also multiplies the
width by the total fish length.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="../reference/interpolate_width.html">interpolate_width</a></span><span class="op">(</span><span class="va">fishwidth</span><span class="op">$</span><span class="va">s</span>, <span class="va">fishwidth</span><span class="op">$</span><span class="va">ammowidth</span>, <span class="va">arclen</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We just added another column to <code>lampreydata</code> containing
the width at each arclength along the body, defined in mm because the
arc length is in mm.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 10</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   frame [1]</span></span></span>
<span><span class="co">#&gt;        t frame point  mxmm  mymm arclen0 arclen mxmm_s mymm_s  width</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   0.2    10     1  381.  133.    0      0      381.   133. 2.48  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   0.2    10     2  389.  134.    7.78   8.13   389.   135. 2.61  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   0.2    10     3  396.  136.   15.6   16.3    397.   136. 2.75  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   0.2    10     4  404.  137.   23.4   24.4    405.   137. 2.81  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   0.2    10     5  412.  138.   31.1   32.5    413.   138. 2.83  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   0.2    10     6  420.  137.   38.9   40.7    421.   136. 2.85  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   0.2    10     7  427.  134.   46.7   48.8    429.   133. 2.88  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   0.2    10     8  434.  132.   54.5   56.9    437.   131. 2.80  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   0.2    10     9  442.  130.   62.3   65.1    445.   130. 2.70  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   0.2    10    10  450.  131.   70.1   73.2    453.   132. 2.61  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>   0.2    10    11  457.  133.   77.8   81.3    460.   135. 2.46  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>   0.2    10    12  464.  138.   85.6   89.5    467.   140. 2.30  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>   0.2    10    13  470.  142.   93.4   97.6    473.   145. 2.14  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>   0.2    10    14  476.  147.  101.   106.     480.   149. 1.96  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>   0.2    10    15  483.  150.  109.   114.     488.   151. 1.74  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>   0.2    10    16  491.  150.  117.   122.     496.   150. 1.51  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>   0.2    10    17  499.  150.  125.   130.     504.   148. 1.27  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>   0.2    10    18  506.  148.  132.   138.     512.   146. 0.923 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>   0.2    10    19  514.  145.  140.   146.     520.   144. 0.574 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>   0.2    10    20  521.  144.  148.   155.     528.   143. 0.013<span style="text-decoration: underline;">5</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compute-the-center-of-mass">Compute the center of mass<a class="anchor" aria-label="anchor" href="#compute-the-center-of-mass"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_midline_center_df.html">get_midline_center_df</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">mxmm_s</span>,<span class="va">mymm_s</span>, width<span class="op">=</span><span class="va">width</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimating center of mass based on width</span></span>
<span></span>
<span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mxmm_s</span>, y <span class="op">=</span> <span class="va">mymm_s</span>, color <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">point</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcom</span>, y <span class="op">=</span> <span class="va">ycom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="compute-curvature">Compute curvature<a class="anchor" aria-label="anchor" href="#compute-curvature"></a>
</h3>
<p>This computes the curvature by the two different methods.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>curve_ang <span class="op">=</span> <span class="fu"><a href="../reference/curvature.html">curvature</a></span><span class="op">(</span><span class="va">arclen0</span>, <span class="va">mxmm_s</span>, <span class="va">mymm_s</span><span class="op">)</span>,</span>
<span>         curve_xy <span class="op">=</span> <span class="fu"><a href="../reference/curvature.html">curvature</a></span><span class="op">(</span><span class="va">arclen0</span>, <span class="va">mxmm_s</span>, <span class="va">mymm_s</span>, method<span class="op">=</span><span class="st">"xy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Compare the results. Here they aren’t very different, although the
“xy” method gives very slightly higher peaks.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen0</span>, color <span class="op">=</span> <span class="va">frame</span>, group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">curve_ang</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">'solid'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">curve_xy</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">'dashed'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span>
<span><span class="co">#&gt; Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-14-1.png" width="700">
Plot curvature as a function of time for two different points along the
body. For the Hilbert analysis to work well, these should be close to
sinusoidal and centered around 0.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">curve_ang</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="get-excursion">Get excursion<a class="anchor" aria-label="anchor" href="#get-excursion"></a>
</h3>
<p>This extracts the central swimming axis.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span> <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mxmm_ctr <span class="op">=</span> <span class="va">mxmm_s</span> <span class="op">-</span> <span class="va">xcom</span>,</span>
<span>         mymm_ctr <span class="op">=</span> <span class="va">mymm_s</span> <span class="op">-</span> <span class="va">ycom</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_primary_swimming_axis_df.html">get_primary_swimming_axis_df</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">mxmm_ctr</span>, <span class="va">mymm_ctr</span>, .frame<span class="op">=</span><span class="va">frame</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mxmm</span>, y <span class="op">=</span> <span class="va">mymm</span>, color <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">point</span> <span class="op">==</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcom</span>, y <span class="op">=</span> <span class="va">ycom</span>, </span>
<span>                   xend <span class="op">=</span> <span class="va">xcom</span> <span class="op">-</span> <span class="fl">50</span><span class="op">*</span><span class="va">swimaxis_x</span>, </span>
<span>                   yend <span class="op">=</span> <span class="va">ycom</span> <span class="op">-</span> <span class="fl">50</span><span class="op">*</span><span class="va">swimaxis_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">point</span> <span class="op">==</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcom</span>, y <span class="op">=</span> <span class="va">ycom</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">frame</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Similar to curvature, we can compute phases based on the lateral
excursions (<code>b</code>). As above, they need to be mostly sinusoidal
and centered around zero.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">exc</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="phase">Phase<a class="anchor" aria-label="anchor" href="#phase"></a>
</h3>
<div class="section level4">
<h4 id="smooth-the-data-again">Smooth the data again<a class="anchor" aria-label="anchor" href="#smooth-the-data-again"></a>
</h4>
<p>To ensure that we have smooth enough data for the phase estimation,
we smooth the oscillations here again.</p>
<p>Get the sample frequency.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampfreq</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>sampfreq <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">t</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">t</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">sampfreq</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sampfreq</span></span>
<span><span class="co">#&gt; [1] 50</span></span></code></pre></div>
<p>Build the filter. <code>build_filter</code> here is just a small
wrapper function for <code><a href="https://rdrr.io/pkg/gsignal/man/butter.html" class="external-link">gsignal::butter</a></code>, which builds a
Butterwoth filter and returns it in SoS format.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_filter.html">build_filter</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">15</span>, sampfreq <span class="op">=</span> <span class="va">sampfreq</span><span class="op">)</span></span></code></pre></div>
<p>Apply the filter for each point over time. Make sure that you are
smoothing each point individually (i.e., use
<code>group_by(point)</code>) and that the data are sorted in time.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">point</span>, <span class="va">t</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>exc_s <span class="op">=</span> <span class="fu"><a href="../reference/apply_filter.html">apply_filter</a></span><span class="op">(</span><span class="va">filt</span>, <span class="va">exc</span><span class="op">)</span>,</span>
<span>         curve_ang_s <span class="op">=</span> <span class="fu"><a href="../reference/apply_filter.html">apply_filter</a></span><span class="op">(</span><span class="va">filt</span>, <span class="va">curve_ang</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">exc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">exc_s</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span>
<span><span class="co">#&gt; Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Now we compute the phase of each body point as it oscillates over
time, looking at either the curvature <code>curve_ang</code> or the
excursion <code>b</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">frame</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ph_c <span class="op">=</span> <span class="fu"><a href="../reference/hilbert_phase.html">hilbert_phase</a></span><span class="op">(</span><span class="va">curve_ang_s</span><span class="op">)</span>,</span>
<span>         ph_e <span class="op">=</span> <span class="fu"><a href="../reference/hilbert_phase.html">hilbert_phase</a></span><span class="op">(</span><span class="va">exc_s</span><span class="op">)</span>,</span>
<span>         ph_p <span class="op">=</span> <span class="fu"><a href="../reference/peak_phase.html">peak_phase</a></span><span class="op">(</span><span class="va">exc_s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 42 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `ph_c = hilbert_phase(curve_ang_s)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 2: `point = 2`.</span></span>
<span><span class="co">#&gt; Caused by warning in `hilbert_phase()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> For a good phase estimate, the signal should oscillate around 0</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 41 remaining warnings.</span></span></code></pre></div>
<p><code>hilbert_phase</code> does a few checks on the results and gives
warnings if it finds things that might cause problems. * It checks to
make sure that most of the input data is not NA. It does not give a
warning if all of the input data is NA, only if at least some of the
data is not NA. * It checks that the input signal seems to oscillate
around 0. * It looks whether the phase mostly advances over time. If we
have cases when the phase seems to run backwards, that’s often a good
indication that the data isn’t smoothed enough. In the case above, the
warning is for point 2, which is close to the head, where curvature
tends to be quite low, so we can ignore the warning.</p>
<p>Compare the two phase estimates. We expect the slopes to be the same,
but there could be an offset of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">2\pi</annotation></semantics></math>
in places. Here solid lines are phase based on curvature and dashed are
phase based on excursion.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ph_c</span>, <span class="va">ph_e</span>, <span class="va">ph_p</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"method"</span>, values_to <span class="op">=</span> <span class="st">"phase"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">phase</span>, color <span class="op">=</span> <span class="va">point</span>, linetype <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">point</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 93 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-24-1.png" width="700">
Note that the curvature based phase (solid line) tends to fluctuate a
lot for point 3, which is near the head where curvature is small.</p>
</div>
<div class="section level4">
<h4 id="example-phase-figure">Example phase figure<a class="anchor" aria-label="anchor" href="#example-phase-figure"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">examplet</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#1f78b4"</span>, <span class="st">"black"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">exc</span>, color <span class="op">=</span> <span class="va">point</span>, linetype <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">examplet</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time (s)"</span>, y <span class="op">=</span> <span class="st">"Excursion (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span>,</span>
<span>        panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span>,</span>
<span>         ph_e <span class="op">=</span> <span class="op">(</span><span class="va">ph_e</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">ph_e</span>, color <span class="op">=</span> <span class="va">point</span>, linetype <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">examplet</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time (s)"</span>, y <span class="op">=</span> <span class="st">"Phase"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span>,</span>
<span>        panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html" class="external-link">near</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">examplet</span>, tol <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">exc</span>, x <span class="op">=</span> <span class="va">exc_x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">point</span>, shape <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html" class="external-link">near</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">examplet</span>, tol <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ph_eu <span class="op">=</span> <span class="op">(</span><span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_e</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ph_eu</span>, x <span class="op">=</span> <span class="va">arclen</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co">#color = "#1b9e77") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">point</span>, shape <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Arc length (mm)"</span>, y <span class="op">=</span> <span class="st">"Phase"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span>,</span>
<span>        panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># scale_y_continuous(transform = "reverse") </span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 108 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span>
<span><span class="co">#&gt; Removed 108 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="frequency">Frequency<a class="anchor" aria-label="anchor" href="#frequency"></a>
</h3>
<p>As described above, the time derivative of the phase is the
frequency. Here, we can compute a frequency at each point along the
body, although they ought to be the same.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>freq_c <span class="op">=</span> <span class="fu"><a href="../reference/get_frequency.html">get_frequency</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ph_c</span>, method<span class="op">=</span><span class="st">'deriv'</span><span class="op">)</span>,</span>
<span>         freq_e <span class="op">=</span> <span class="fu"><a href="../reference/get_frequency.html">get_frequency</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ph_e</span>, method<span class="op">=</span><span class="st">'deriv'</span><span class="op">)</span>,</span>
<span>         freq_p <span class="op">=</span> <span class="fu"><a href="../reference/get_frequency.html">get_frequency</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ph_p</span>, method<span class="op">=</span><span class="st">'deriv'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">freq_c</span>, <span class="va">freq_e</span>, <span class="va">freq_p</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"method"</span>, values_to <span class="op">=</span> <span class="st">"freq"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">freq</span>, color <span class="op">=</span> <span class="va">point</span>, shape <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">17</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">point</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 4 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `freq_c = get_frequency(t, ph_c, method = "deriv")`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 2: `point = 2`.</span></span>
<span><span class="co">#&gt; Caused by warning in `get_frequency()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Phase seems to go backwards a lot, which may indicate an overly noisy signal</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 3 remaining warnings.</span></span>
<span><span class="co">#&gt; Warning: Removed 79 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-26-1.png" width="700">
# Body wavelength</p>
<p>Body wavelength, as described above, is the derivative of the phase
of each point along the body with respect to arc length. Phase typically
decreases along the body, which indicates a backward traveling wave.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phbody <span class="op">=</span> <span class="va">ph_p</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen</span>, y <span class="op">=</span> <span class="va">phbody</span>, color <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 20 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-27-1.png" width="700">
The apparent discontinuity at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
= 50mm is not real. It just reflects the fact that phase goes from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">2\pi</annotation></semantics></math>
and then wraps around back to 0. We get rid of that by using the
<code>unwrap</code> function, applied across the spatial dimension
(equivalently, using <code>group_by</code> with time or frame
number).</p>
<p>This is the phase across the body with the discontinuities
removed.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phbody <span class="op">=</span> <span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_e</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen</span>, y <span class="op">=</span> <span class="va">phbody</span>, color <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">frame</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="methods-of-estimating-wavelength">Methods of estimating wavelength<a class="anchor" aria-label="anchor" href="#methods-of-estimating-wavelength"></a>
</h3>
<p>There are several ways to estimate body wavelength based on the body
phase, which have different advantages and disadvantages. The function
<code>get_wavelength</code> can run each of them.</p>
<ol style="list-style-type: decimal">
<li><p>At each point along the body, you can estimate the derivative of
the phase with respect to arc length. This gives the most comprehensive
results, and, in particular, makes it fairly simple to consider whether
wavelength varies along the body, but is also very sensitive to
noise.</p></li>
<li><p>You can fit a line to all of the data along the body and take the
slope of that line. This method is the least sensitive to noise, but
only gives a single value along the entire body.</p></li>
<li><p>You can look for the distance along the body in which the phase
changes by a full or a half cycle. If you look for the phase at the tail
and then step backward along the body until you find a point that’s
either a full or half cycle before the tail, then that distance
represents a full or half wave, respectively.
<code>get_wavelength</code> makes this process more accurate by using a
simple linear interpolation to find the distance that represents exactly
1 or 0.5 waves.</p></li>
</ol>
<p>The phase tends to be poorly estimated for body points that are more
anterior. <code>get_wavelength</code> allows you to specify a formula to
ignore certain locations for the estimate.</p>
<p>Here is an example for a single frame. We’re ignoring points that are
less than 30mm from the head.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">frame</span>, <span class="va">arclen</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">frame</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ph2 <span class="op">=</span> <span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_e</span><span class="op">)</span>,</span>
<span>         wavelen_deriv <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">ph2</span>, method<span class="op">=</span><span class="st">"deriv"</span>,</span>
<span>                                   ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>         wavelen_slope <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">ph2</span>, method<span class="op">=</span><span class="st">"slope"</span>,</span>
<span>                                   ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>         wavelen_cycle <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">ph2</span>, method<span class="op">=</span><span class="st">"cycle"</span>,</span>
<span>                                   ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span>,</span>
<span>                                   sort_arclen <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>         wavelen_halfcycle <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">ph2</span>, method<span class="op">=</span><span class="st">"halfcycle"</span>,</span>
<span>                                   ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span>,</span>
<span>                                   sort_arclen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"wavelen"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"method"</span>, values_to <span class="op">=</span> <span class="st">"wavelen"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen</span>, y <span class="op">=</span> <span class="va">wavelen</span>, color <span class="op">=</span> <span class="va">method</span>, shape <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 41 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-29-1.png" width="700">
Here, you can see that all of the methods give similar results, but
there are different numbers of values and different resolution along the
body. We suggest the “halfcycle” option as a good, relatively robust
compromise.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">frame</span>, <span class="va">arclen</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phbody_e <span class="op">=</span> <span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_e</span><span class="op">)</span>,</span>
<span>         phbody_c <span class="op">=</span> <span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_c</span><span class="op">)</span>,</span>
<span>         wavelen_exc <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">phbody_e</span>, method<span class="op">=</span><span class="st">"halfcycle"</span>,</span>
<span>                                    ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>         wavelen_curve <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">phbody_c</span>, method<span class="op">=</span><span class="st">"halfcycle"</span>,</span>
<span>                                    ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"wavelen"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"method"</span>, values_to <span class="op">=</span> <span class="st">"wavelen"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">wavelen</span>, color <span class="op">=</span> <span class="va">arclen</span>, shape<span class="op">=</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 6 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `wavelen_exc = get_wavelength(...)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 3: `frame = 3`.</span></span>
<span><span class="co">#&gt; Caused by warning in `get_wavelength()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Phase does not seem to be decreasing along the body. Wavelength may be strange</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 5 remaining warnings.</span></span>
<span><span class="co">#&gt; Warning: Removed 2838 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-30-1.png" width="700">
Here we see that wavelength estimated based on curvature is slightly
noisier than curvature based on excursion, and that both fluctuate over
time.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">frame</span>, <span class="va">arclen</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phbody_e <span class="op">=</span> <span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_e</span><span class="op">)</span>,</span>
<span>         phbody_c <span class="op">=</span> <span class="fu">gsignal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsignal/man/unwrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ph_c</span><span class="op">)</span>,</span>
<span>         wavelen_exc <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">phbody_e</span>, method<span class="op">=</span><span class="st">"halfcycle"</span>,</span>
<span>                                    ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>         wavelen_curve <span class="op">=</span> <span class="fu"><a href="../reference/get_wavelength.html">get_wavelength</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">phbody_c</span>, method<span class="op">=</span><span class="st">"halfcycle"</span>,</span>
<span>                                    ignore_arclen_vals <span class="op">=</span> \<span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"wavelen"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"method"</span>, values_to <span class="op">=</span> <span class="st">"wavelen"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">wavelen</span>, color <span class="op">=</span> <span class="va">arclen</span>, shape<span class="op">=</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">method</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 6 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `wavelen_exc = get_wavelength(...)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 3: `frame = 3`.</span></span>
<span><span class="co">#&gt; Caused by warning in `get_wavelength()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Phase does not seem to be decreasing along the body. Wavelength may be strange</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 5 remaining warnings.</span></span>
<span><span class="co">#&gt; Warning: Removed 2838 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-31-1.png" width="700">
This plot shows wavelength as a function of body position and estimation
method. The curvature-based wavelengths seem to increase along the body
(aside from some erroneous very low values very close to the tail),
while the excursion-based wavelengths tend to decrease moving toward the
tail.</p>
</div>
</div>
<div class="section level2">
<h2 id="amplitude">Amplitude<a class="anchor" aria-label="anchor" href="#amplitude"></a>
</h2>
<p>To estimate amplitude, it’s helpful to set up an overall cycle number
for the whole body. We define this based on the excursion of the tail
point. <code>get_body_cycle_numbers</code> also excludes partial
cycles.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/get_body_cycle_numbers_df.html">get_body_cycle_numbers_df</a></span><span class="op">(</span><span class="va">ph_p</span>, <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">point</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lampreydata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,600 × 26</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   point [20]</span></span></span>
<span><span class="co">#&gt;        t frame point  mxmm  mymm arclen0 arclen mxmm_s mymm_s width  xcom  ycom</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  0.02     1     1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>   0        <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.48    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  0.02     1     2    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>   8.13     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.61    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  0.02     1     3    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  16.3      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.75    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  0.02     1     4    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  24.4      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.81    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  0.02     1     5    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  32.5      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.83    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.02     1     6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  40.7      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.85    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.02     1     7    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  48.8      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.88    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  0.02     1     8    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  56.9      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.80    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  0.02     1     9    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  65.1      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.70    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  0.02     1    10    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>  73.2      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  2.61    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,590 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more variables: curve_ang &lt;dbl&gt;, curve_xy &lt;dbl&gt;, mxmm_ctr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   mymm_ctr &lt;dbl&gt;, swimaxis_x &lt;dbl&gt;, swimaxis_y &lt;dbl&gt;, exc_x &lt;dbl&gt;, exc &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   exc_s &lt;dbl&gt;, curve_ang_s &lt;dbl&gt;, ph_c &lt;dbl&gt;, ph_e &lt;dbl&gt;, ph_p &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cycle &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now, we can use <code>group_by</code> on cycles to find
cycle-by-cycle values. Here, we look for the range of the excursion
variable <code>b</code>. Half of that range is the amplitude, which we
can define at each point on the body, and over the four cycles that are
present in this trial.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lampreydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">point</span>, <span class="va">cycle</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>amp <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>            arclen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">arclen</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen</span>, y <span class="op">=</span> <span class="va">amp</span>, color <span class="op">=</span> <span class="va">cycle</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">cycle</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'point'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="co">#&gt; Warning: Removed 20 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="fishmechr_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Tytell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
