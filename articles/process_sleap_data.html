<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>process_sleap_data • fishmechr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="process_sleap_data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fishmechr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/fishmechr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/prickleback_swimming.html">prickleback_swimming</a></li>
    <li><a class="dropdown-item" href="../articles/process_sleap_data.html">process_sleap_data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>process_sleap_data</h1>
            
      

      <div class="d-none name"><code>process_sleap_data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tytell.github.io/fishmechr/">fishmechr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'dplyr::filter' by 'gsignal::filter' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::conv' by 'pracma::conv' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::ifftshift' by 'pracma::ifftshift'</span></span>
<span><span class="co">#&gt; when loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::findpeaks' by 'pracma::findpeaks'</span></span>
<span><span class="co">#&gt; when loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::fftshift' by 'pracma::fftshift'</span></span>
<span><span class="co">#&gt; when loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::ifft' by 'pracma::ifft' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'gsignal::detrend' by 'pracma::detrend' when</span></span>
<span><span class="co">#&gt; loading 'fishmechr'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fishmechr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     deriv</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cli.r-lib.org" class="external-link">cli</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cli.progress_show_after <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cli.progress_clear <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>These are your SLEAP output data files. This is example code that you
could use. For the vignette, these data files are included in the
package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sleapfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data-raw"</span>,<span class="st">"2024-11-14_labels2.000_fish_01-030RPM-ortho-2024-11-14T044441.analysis.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data-raw"</span>,<span class="st">"2024-11-14_labels2.001_fish_01-040RPM-ortho-2024-11-14T044525.analysis.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"2024-11-14_labels2.002_fish_01-050RPM-ortho-2024-11-14T045204.analysis.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data-raw"</span>,<span class="st">"2024-11-14_labels2.003_fish_01-060RPM-ortho-2024-11-14T044754.analysis.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="st">"data-raw"</span>,<span class="st">"2024-11-14_labels2.004_fish_01-070RPM-ortho-2024-11-14T044858.analysis.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parse_file_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fn</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_match.html" class="external-link">str_match</a></span><span class="op">(</span><span class="va">fn</span>, </span>
<span>                 <span class="st">"_(?&lt;id&gt;\\w+_\\d+)-(?&lt;speed&gt;\\d+)RPM.+(?&lt;datetime&gt;\\d{4}-\\d{2}-\\d{2}T\\d{6})"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble_row</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, .name_repair <span class="op">=</span> <span class="st">"minimal"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">zfishdata</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">sleapfiles</span>, \<span class="op">(</span><span class="va">fn</span><span class="op">)</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="va">fn</span>, id <span class="op">=</span> <span class="st">"fn"</span>, </span>
<span>                                         show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dd <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fn</span>, <span class="va">parse_file_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span>,</span>
<span>         speed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">speed</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">zfish_goodframes</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"zfish_goodframes.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">zfishdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 46</span></span></span>
<span><span class="co">#&gt;   fn        track frame_idx instance.score left_pec_fin_tip.x left_pec_fin_tip.y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2024-11-… <span style="color: #BB0000;">NA</span>            0          <span style="color: #BB0000;">NA</span>                  315.               185.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2024-11-… <span style="color: #BB0000;">NA</span>            1          <span style="color: #BB0000;">NA</span>                  315.               180.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2024-11-… <span style="color: #BB0000;">NA</span>            2           9.99               317.               176.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2024-11-… <span style="color: #BB0000;">NA</span>            3          <span style="color: #BB0000;">NA</span>                  315.               169.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2024-11-… <span style="color: #BB0000;">NA</span>            4          <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2024-11-… <span style="color: #BB0000;">NA</span>            5           9.84                <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more variables: left_pec_fin_tip.score &lt;dbl&gt;, right_eye.x &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   right_eye.y &lt;dbl&gt;, right_eye.score &lt;dbl&gt;, left_eye.x &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   left_eye.y &lt;dbl&gt;, left_eye.score &lt;dbl&gt;, right_pec_fin_base.x &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   right_pec_fin_base.y &lt;dbl&gt;, right_pec_fin_base.score &lt;dbl&gt;, anus.x &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   anus.y &lt;dbl&gt;, anus.score &lt;dbl&gt;, hyoid.x &lt;dbl&gt;, hyoid.y &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   hyoid.score &lt;dbl&gt;, dorsal_caudal.x &lt;dbl&gt;, dorsal_caudal.y &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dorsal_caudal.score &lt;dbl&gt;, peduncle.x &lt;dbl&gt;, peduncle.y &lt;dbl&gt;, …</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">zfish_goodframes</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   File                                                         Start   End Block</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2024-11-14_labels2.000_fish_01-030RPM-ortho-2024-11-14T0444…     1   250     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2024-11-14_labels2.001_fish_01-040RPM-ortho-2024-11-14T0445…     1   250     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2024-11-14_labels2.002_fish_01-050RPM-ortho-2024-11-14T0452…     1    71     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2024-11-14_labels2.002_fish_01-050RPM-ortho-2024-11-14T0452…   167   250     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2024-11-14_labels2.003_fish_01-060RPM-ortho-2024-11-14T0447…    48   135     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2024-11-14_labels2.003_fish_01-060RPM-ortho-2024-11-14T0447…   224   250     2</span></span></code></pre></div>
<p>Frame rate from your cameras</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fps</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></code></pre></div>
<p>These are all our points, ordered from head to tail</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pointnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"eye_ctr"</span>, <span class="st">"left_eye"</span>, <span class="st">"right_eye"</span>, <span class="st">"hyoid"</span>,   </span>
<span>                <span class="st">"pec_fin_ctr"</span>, <span class="st">"left_pec_fin_base"</span>, <span class="st">"left_pec_fin_tip"</span>, </span>
<span>                <span class="st">"right_pec_fin_base"</span>, <span class="st">"right_pec_fin_tip"</span>, <span class="st">"pelvic_fin_base"</span>,</span>
<span>                <span class="st">"anus"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span>, <span class="st">"dorsal_caudal"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_ctr</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">zfishdata</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>eye_ctr.x <span class="op">=</span> <span class="op">(</span><span class="va">left_eye.x</span> <span class="op">+</span> <span class="va">right_eye.x</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>         eye_ctr.y <span class="op">=</span> <span class="op">(</span><span class="va">left_eye.y</span> <span class="op">+</span> <span class="va">right_eye.y</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>         eye_ctr.score <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>         pec_fin_ctr.x <span class="op">=</span> <span class="op">(</span><span class="va">left_pec_fin_base.x</span> <span class="op">+</span> <span class="va">right_pec_fin_base.x</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>         pec_fin_ctr.y <span class="op">=</span> <span class="op">(</span><span class="va">left_pec_fin_base.y</span> <span class="op">+</span> <span class="va">right_pec_fin_base.y</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>         pec_fin_ctr.score <span class="op">=</span> <span class="cn">NA</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_ctr</span> <span class="op">&lt;-</span> <span class="va">zfdata_ctr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">speed</span>, <span class="va">datetime</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/pivot_kinematics_longer.html">pivot_kinematics_longer</a></span><span class="op">(</span>pointnames <span class="op">=</span> <span class="va">pointnames</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">zfdata_ctr</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#&gt;   id      speed datetime  fn    track frame_idx instance.score point     x     y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>            0             <span style="color: #BB0000;">NA</span> snout  144.  189.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>            0             <span style="color: #BB0000;">NA</span> eye_…  173.  209.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>            0             <span style="color: #BB0000;">NA</span> left…  188.  181.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>            0             <span style="color: #BB0000;">NA</span> righ…  157.  237.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>            0             <span style="color: #BB0000;">NA</span> hyoid  176.  221.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>            0             <span style="color: #BB0000;">NA</span> pec_…  233.  238.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: score &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now pull out just the good frames based on our other data table</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">zfish_goodframes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">good1</span> <span class="op">&lt;-</span> <span class="va">zfdata_ctr</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fn</span> <span class="op">==</span> <span class="va">zfish_goodframes</span><span class="op">$</span><span class="va">File</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">frame_idx</span>, <span class="va">zfish_goodframes</span><span class="op">$</span><span class="va">Start</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">zfish_goodframes</span><span class="op">$</span><span class="va">End</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>block <span class="op">=</span> <span class="va">zfish_goodframes</span><span class="op">$</span><span class="va">Block</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">zfdata_good</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">good1</span></span>
<span><span class="op">}</span></span>
<span><span class="va">zfdata_good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">zfdata_good</span><span class="op">)</span></span></code></pre></div>
<p>This shows the x and y positions of several of the points in multiple
frames.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_good</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">frame_idx</span>, <span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">speed</span> <span class="op">==</span> <span class="fl">30</span>,</span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">frame_idx</span>, <span class="fl">120</span>, <span class="fl">140</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"hyoid"</span>, <span class="st">"eye_ctr"</span>, <span class="st">"pec_fin_ctr"</span>, </span>
<span>                      <span class="st">"pelvic_fin_base"</span>, <span class="st">"anus"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">frame_idx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 20 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>This shows just the y coordinate against frame number.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_good</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">frame_idx</span>, <span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">speed</span> <span class="op">==</span> <span class="fl">40</span>,</span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">frame_idx</span>, <span class="fl">120</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">frame_idx</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 39 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This smooths the data and fills in gaps. Focus just on the points
along the ventral midline for right now.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_sm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">zfdata_good</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">frame_idx</span>, <span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"hyoid"</span>, <span class="st">"eye_ctr"</span>, <span class="st">"pec_fin_ctr"</span>, </span>
<span>                      <span class="st">"pelvic_fin_base"</span>, <span class="st">"anus"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">fn</span>, <span class="va">frame_idx</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculate the arc length</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>arclen0 <span class="op">=</span> <span class="fu"><a href="../reference/arclength.html">arclength</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.skip <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># smooth and fill gaps</span></span>
<span>  <span class="fu"><a href="../reference/interpolate_points_df.html">interpolate_points_df</a></span><span class="op">(</span><span class="va">arclen0</span>, <span class="va">x</span>, <span class="va">y</span>, spar <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                        tailmethod <span class="op">=</span> <span class="st">'extrapolate'</span>,</span>
<span>                        fill_gaps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        .frame <span class="op">=</span> <span class="va">frame_idx</span>,</span>
<span>                        .out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>arclen<span class="op">=</span><span class="st">'arclen'</span>, xs<span class="op">=</span><span class="st">'xs'</span>, ys<span class="op">=</span><span class="st">'ys'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">frame_idx</span>, <span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">speed</span> <span class="op">==</span> <span class="fl">40</span>,</span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">frame_idx</span>, <span class="fl">120</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">frame_idx</span>, y <span class="op">=</span> <span class="va">ys</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Now we need to find the center of mass. For that we need the width
and height of the body at each point along the body. These values are
all in fractions of the total length.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zebrafish_shape</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">height</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Now interpolate and scale these width and height values for the
actual length of our fish.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_sm</span> <span class="op">&lt;-</span> <span class="va">zfdata_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">speed</span>, <span class="va">datetime</span>, <span class="va">frame_idx</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="../reference/interpolate_width.html">interpolate_width</a></span><span class="op">(</span><span class="va">zebrafish_shape</span><span class="op">$</span><span class="va">s</span>,</span>
<span>                                   <span class="va">zebrafish_shape</span><span class="op">$</span><span class="va">width</span>,</span>
<span>                                   <span class="va">arclen</span><span class="op">)</span>,</span>
<span>         height <span class="op">=</span> <span class="fu"><a href="../reference/interpolate_width.html">interpolate_width</a></span><span class="op">(</span><span class="va">zebrafish_shape</span><span class="op">$</span><span class="va">s</span>,</span>
<span>                                   <span class="va">zebrafish_shape</span><span class="op">$</span><span class="va">height</span>,</span>
<span>                                   <span class="va">arclen</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">speed</span> <span class="op">==</span><span class="fl">30</span>,</span>
<span>         <span class="va">frame_idx</span> <span class="op">==</span> <span class="fl">150</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 18</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   id, speed, datetime, frame_idx [1]</span></span></span>
<span><span class="co">#&gt;   id      speed datetime  fn    track frame_idx instance.score point     x     y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> snout  207.  644.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> eye_…   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> hyoid  256.  632.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> pec_…  298.  623.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> pelv…  431.  597.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> anus   512.  560.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> pedu…  700.  533.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> fish_01    30 2024-11-… 2024… <span style="color: #BB0000;">NA</span>          150             <span style="color: #BB0000;">NA</span> vent…  771.  482.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: score &lt;dbl&gt;, block &lt;dbl&gt;, arclen0 &lt;dbl&gt;, arclen &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   xs &lt;dbl&gt;, ys &lt;dbl&gt;, width &lt;dbl&gt;, height &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now we need to split out different swimming sequences</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_split</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">zfdata_sm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">speed</span>, <span class="va">datetime</span>, <span class="va">block</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_ctr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">zfdata_split</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">zfdata_ctr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">zfdata_split</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../reference/get_midline_center_df.html">get_midline_center_df</a></span><span class="op">(</span><span class="va">arclen</span>, <span class="va">xs</span>, <span class="va">ys</span>,</span>
<span>                          width <span class="op">=</span> <span class="va">width</span>, height <span class="op">=</span> <span class="va">height</span>,</span>
<span>                          .frame <span class="op">=</span> <span class="va">frame_idx</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># center everything on the center of mass</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>xctr <span class="op">=</span> <span class="va">xs</span> <span class="op">-</span> <span class="va">xcom</span>,</span>
<span>           yctr <span class="op">=</span> <span class="va">ys</span> <span class="op">-</span> <span class="va">ycom</span>,</span>
<span>           t <span class="op">=</span> <span class="va">frame_idx</span> <span class="op">/</span> <span class="va">fps</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># find the main axis of the body</span></span>
<span>    <span class="fu"><a href="../reference/get_primary_swimming_axis_df.html">get_primary_swimming_axis_df</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">xctr</span>, <span class="va">yctr</span>, </span>
<span>                                 .frame <span class="op">=</span> <span class="va">frame_idx</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Some frames have missing points. Dropping COM estimates for those frames</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Estimating center of mass based on width and height</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Some frames have missing points. Dropping COM estimates for those frames</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_ctr</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">exc_x</span>, y <span class="op">=</span> <span class="va">exc</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">frame_idx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_ctr</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># filter(between(t, 1, 1.2)) |&gt; </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">exc</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_phase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">zfdata_ctr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">zfdata_phase</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">zfdata_ctr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">speed</span>, <span class="va">datetime</span>, <span class="va">frame_idx</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">speed</span>, <span class="va">datetime</span>, <span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ph_p <span class="op">=</span> <span class="fu"><a href="../reference/peak_phase.html">peak_phase</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: There were 22 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `ph_p = peak_phase(exc)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 1: `id = "fish_01"`, `speed = 70`, `datetime = "2024-11-14T044858"`,</span></span>
<span><span class="co">#&gt;   `point = snout`.</span></span>
<span><span class="co">#&gt; Caused by warning in `peak_phase()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> A large fraction of values are NA. Phase estimate may work poorly</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 21 remaining warnings.</span></span>
<span><span class="co">#&gt; Warning: There were 8 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `ph_p = peak_phase(exc)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 1: `id = "fish_01"`, `speed = 70`, `datetime = "2024-11-14T044858"`,</span></span>
<span><span class="co">#&gt;   `point = snout`.</span></span>
<span><span class="co">#&gt; Caused by warning in `peak_phase()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> A large fraction of values are NA. Phase estimate may work poorly</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 7 remaining warnings.</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_phase</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">ph_p</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">point</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 20 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_phase</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>freq_p <span class="op">=</span> <span class="fu"><a href="../reference/get_frequency.html">get_frequency</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ph_p</span>, method<span class="op">=</span><span class="st">'deriv'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snout"</span>, <span class="st">"peduncle"</span>, <span class="st">"ventral_caudal"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">freq_p</span>, color <span class="op">=</span> <span class="va">point</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">17</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">point</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 26 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_cyc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">zfdata_phase</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">zfdata_cyc</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">zfdata_phase</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>freq <span class="op">=</span> <span class="fu"><a href="../reference/get_frequency.html">get_frequency</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">ph_p</span>, method<span class="op">=</span><span class="st">'deriv'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="../reference/get_body_cycle_numbers_df.html">get_body_cycle_numbers_df</a></span><span class="op">(</span><span class="va">ph_p</span>, pointval <span class="op">=</span> <span class="st">"peduncle"</span>,</span>
<span>                              .frame <span class="op">=</span> <span class="va">frame_idx</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">speed</span>, <span class="va">datetime</span>, <span class="va">block</span>, <span class="va">t</span>, <span class="va">point</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: There were 8 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `freq = get_frequency(t, ph_p, method = "deriv")`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 1: `point = snout`.</span></span>
<span><span class="co">#&gt; Caused by warning in `get_frequency()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Phase seems to go backwards a lot, which may indicate an overly noisy signal</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 7 remaining warnings.</span></span>
<span><span class="co">#&gt; Warning: There were 5 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `freq = get_frequency(t, ph_p, method = "deriv")`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 4: `point = pec_fin_ctr`.</span></span>
<span><span class="co">#&gt; Caused by warning in `get_frequency()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Phase seems to go backwards a lot, which may indicate an overly noisy signal</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 4 remaining warnings.</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_cyc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">point</span>, <span class="va">cycle</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>amp <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>            arclen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">arclen</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arclen</span>, y <span class="op">=</span> <span class="va">amp</span>, color <span class="op">=</span> <span class="va">speed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">cycle</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'speed', 'point'. You can override using</span></span>
<span><span class="co">#&gt; the `.groups` argument.</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_path()`).</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfdata_cyc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">zfdata_cyc</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zfsummary</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">zfdata_cyc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">datetime</span>, <span class="va">speed</span>, <span class="va">frame_idx</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>meanfreq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">point</span> <span class="op">==</span> <span class="st">"ventral_caudal"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">cycle</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>amp <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">exc</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>            arclen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">arclen</span><span class="op">)</span>,</span>
<span>            meanfreq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">meanfreq</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'speed'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">zfsummary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>, y <span class="op">=</span> <span class="va">meanfreq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">speed</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 11 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="process_sleap_data_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">zfsummary</span>, <span class="st">"zfsummary.csv"</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Tytell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
