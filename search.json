[{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"computing-kinematic-parameters","dir":"Articles","previous_headings":"","what":"Computing kinematic parameters","title":"fishmechr","text":"compute midline swimming kinematics accurately, follow steps . Compute arc length along curve body. points consistently arc length, interpolate points one consistent point body. often useful smoothing part step. Compute center location. Ideally center mass, approximated variety ways. Compute body curvature excursion relative central axis, . Estimate phase oscillation point. can either detect peaks zero crossings use mathematical technique called Hilbert transform. Use temporal spatial derivatives phase estimate oscillation frequency, body wavelength, body wave speed. Based phase, identify individual undulation cycles. Within cycle, can identify range body excursion curvature compute amplitude.","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"compute-arc-length","dir":"Articles","previous_headings":"Computing kinematic parameters","what":"1. Compute arc length","title":"fishmechr","text":"kinematic variables best specified terms arc length ss, distance along body head particular point ii: si=‚àëj=2i[(xj‚àíxj‚àí1)2+(yj‚àíyj‚àí1)2] s_i = \\sum_{j=2}^\\left[ (x_j - x_{j-1})^2 + (y_j - y_{j-1})^2 \\right]  Using arc length better something like xx coordinate two reasons. First, often fish swim precisely along xx axis, means points need rotated. Second, many fish swim relatively large amplitude motions, means distance along curve larger distance along swimming direction, particularly near tail amplitudes higher.","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"interpolate-points-for-a-consistent-position","dir":"Articles","previous_headings":"Computing kinematic parameters","what":"2. Interpolate points for a consistent position","title":"fishmechr","text":"Ideally, want point represent consistent location fish‚Äôs body. Particularly fish clear landmarks along body, may able mark middle easily, points may slide along fish‚Äôs length. can use spline interpolate points consistent location. Digitized points often error. part interpolation process, can use smoothing spline smooth error.","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"estimate-a-center-location","dir":"Articles","previous_headings":"Computing kinematic parameters","what":"3. Estimate a center location","title":"fishmechr","text":"center location weighted average location. midline defined xx yy coordinates (xi,yi)(x_i, y_i), four main ways identify center location. mim_i mass segment located (xi,yi)(x_i, y_i) (xi+1,yi+1)(x_{+1}, y_{+1}), xcom=12M‚àë=1n‚àí1mi(xi+1+xi) x_{com} = \\frac{1}{2 M} \\sum_{=1}^{n-1} m_i \\left( x_{+1} + x_i \\right)  ycom=12M‚àë=1n‚àí1mi(yi+1+yi) y_{com} = \\frac{1}{2 M} \\sum_{=1}^{n-1} m_i \\left( y_{+1} + y_i \\right)   MM total mass fish. know mass distribution true masses segments, also use mim_i fraction total mass segment ii MM 1. know mass distribution, can approximate mim_i several ways. best use width height body. body, without fins, elliptical cross section, wiw_i horizontal width hih_i dorso-ventral height point ii, volume segment (xi,yi)(x_i, y_i) (xi+1,yi+1)(x_{+1}, y_{+1}) Vi=œÄŒîsi(wihi+12Œîwihi+12Œîhiwi+13ŒîwiŒîhi) V_i = \\pi \\Delta s_i \\left( w_i h_i + \\tfrac{1}{2} \\Delta w_i h_i + \\tfrac{1}{2} \\Delta h_i w_i + \\tfrac{1}{3} \\Delta w_i \\Delta h_i \\right) Œîsi=si+1‚àísi\\Delta s_i = s_{+1} - s_i, Œîwi=wi+1‚àíwi\\Delta w_i = w_{+1} - w_i, Œîhi=hi+1‚àíhi\\Delta h_i = h_{+1} - h_i. approximate mi‚âàœÅVim_i \\approx \\rho V_i, œÅ\\rho density fish, assume constant, xcom=‚àë=1n‚àí1[Vi(xi+1+xi)]2‚àë=1n‚àí1Vi x_{com} = \\frac{\\sum_{=1}^{n-1} \\left[ V_i \\left( x_{+1} + x_i \\right) \\right] }  { 2 \\sum_{=1}^{n-1} V_i } ycom=‚àë=1n‚àí1[Vi(yi+1+yi)]2‚àë=1n‚àí1Vi y_{com} = \\frac{\\sum_{=1}^{n-1} \\left[ V_i \\left( y_{+1} + y_i \\right) \\right] }  { 2 \\sum_{=1}^{n-1} V_i } Often width visible camera , height known. case, reasonable approximation mi‚àùwim_i \\propto w_i, xcom=‚àë=1nwixi‚àë=1nwi x_{com} = \\frac{\\sum_{=1}^{n} w_i x_i}{\\sum_{=1}^{n} w_i} ycom=‚àë=1nwiyi‚àë=1nwi y_{com} = \\frac{\\sum_{=1}^{n} w_i y_i}{\\sum_{=1}^{n} w_i} Choose one point along body use center. snout point close center mass. called ‚Äústretched-straight center mass‚Äù, tends give inaccurate estimates velocity acceleration.","code":""},{"path":[]},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"curvature","dir":"Articles","previous_headings":"Computing kinematic parameters > 4. Estimate curvature or lateral excursion","what":"Curvature","title":"fishmechr","text":"2D curvature Œ∫\\kappa midline horizontal plane often useful variable compute. particular, usually proportional muscle strain point body (Shadwick 1998, Katz 1999). contrast, lateral excursion body usually good estimate muscle strain (Shadwick 1998). Mathematically, curvature can thought two different ways. First, inverse radius curvature: radius circle drawn three successive points. smaller radius curvature, sharper body bend, larger value Œ∫\\kappa. estimate curvature defined following equation Œ∫=[‚àÇx‚àÇs‚àÇ2y‚àÇs2‚àí‚àÇy‚àÇs‚àÇ2x‚àÇs2][(‚àÇx‚àÇs)2+(‚àÇy‚àÇs)2]‚àí3/2 \\kappa = \\left[ \\frac{\\partial x}{\\partial s} \\frac{\\partial^2 y}{\\partial s^2} - \\frac{\\partial y}{\\partial s} \\frac{\\partial^2 x}{\\partial s^2} \\right] \\left[ \\left( \\frac{\\partial x}{\\partial s} \\right)^2 + \\left( \\frac{\\partial y}{\\partial s} \\right)^2 \\right]^{-3/2} Second, spatial derivative angle segment. segment arc length ss angle Œ∏\\theta horizontal axis, curvature Œ∫=‚àÇŒ∏‚àÇs \\kappa = \\frac{\\partial \\theta}{\\partial s}  angle segment ii Œ∏i=tan‚àí1(yi+1‚àíyi,xi+1‚àíxi)\\theta_i = \\tan^{-1}(y_{+1} - y_i, x_{+1} - x_i). Although formulas mathematically equivalent, slightly different properties depending measurement error xx yy positions.","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"lateral-excursion","dir":"Articles","previous_headings":"Computing kinematic parameters > 4. Estimate curvature or lateral excursion","what":"Lateral excursion","title":"fishmechr","text":"One can also estimate body phase, wavelength wave speed, based excursion body relative primary axis. suggest using singular value decomposition (SVD) estimate primary axis, using low-pass filter remove oscillations tail beat frequency higher. matrix xx yy coordinates points along body specific time, ùêó\\mathbf{X}ùêón√ó2=(x1y1x2y2‚ãÆ‚ãÆxnyn) \\mathbf{X}_{n\\times2} =  \\begin{pmatrix}  x_1 & y_1 \\\\ x_2 & y_2 \\\\ \\vdots & \\vdots \\\\ x_n & y_n \\end{pmatrix}  subscript indicates size matrix (nn points along body 2). First, center axis subtracting location center mass mean column, produce matrix ùêóùêÇ\\mathbf{X^C}, centered around 0. singular value decomposition allows write matrix form ùêón√ó2C=ùêîn√ónùö∫n√ó2ùêï2√ó2T. \\mathbf{X}^C_{n\\times2} = \\mathbf{U}_{n\\times n} \\mathbf{\\Sigma}_{n \\times 2} \\mathbf{V}_{2 \\times 2}^T.  matrix ùêï2√ó2\\mathbf{V}_{2 \\times 2} represents principal axes body frame. matrix can estimated time point, produce time-varying matrix ùêï(t)\\mathbf{V}(t). Assuming amplitude relatively small, first column ùêï\\mathbf{V} represents unit vector pointing along primary axis body (call ùêöÃÇ(t)\\mathbf{\\hat{}}(t) second column unit vector normal primary axis. suggest using low pass filter cutoff frequency tail beat frequency smooth components ùêöÃÇ(t)\\mathbf{\\hat{}}(t) vector, making sure normalize smoothing. See implementation details .","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"estimate-phase","dir":"Articles","previous_headings":"Computing kinematic parameters","what":"5. Estimate phase","title":"fishmechr","text":"estimate undulation frequency, body wavelength, wave speed, consider simple equation midline. Fish swim using traveling wave curvature Œ∫s\\kappa_s (lateral excursion) defined arc length ss along body Œ∫(s,t)=(s)cos(2œÄ[sŒª‚àíft])\\begin{equation} \\kappa(s, t) = (s) \\cos\\left(2\\pi \\left[ \\frac{s}{\\lambda} - f t \\right] \\right)  \\end{equation} (s)(s) wave amplitude, kk wave length, ff oscillation frequency, tt time. case, phase oscillation œï(s,t)\\phi(s, t) particular point along body approximately equal argument cosine, 2œÄ(s/Œª‚àíft)2\\pi \\left( s / \\lambda - f t \\right). amplitude AA varies quickly time space, approximation may exactly correct. can estimate phase accurately, can use spatial (.e., respect ss) temporal derivative estimate Œª\\lambda, body wavelength, ff undulation frequency. , describe two methods estimating phase.","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"use-the-hilbert-transform","dir":"Articles","previous_headings":"Computing kinematic parameters > 5. Estimate phase","what":"Use the Hilbert transform","title":"fishmechr","text":"One convenient relatively robust way estimate phase body point involves use Hilbert transform ùêá\\mathbf{H}, procedure uses Fourier transform estimate periodic signal 90deg shifted relative another. essence, given cosine signal, Hilbert transform returns sine amplitude frequency. utility operation lets us estimate ``analytic signal‚Äô‚Äô, complex-valued signal magnitude complex number amplitude wave phase angle complex number phase signal. can take Hilbert transform estimate analytic signal curvature lateral excursion Œ∫*(s,t)=Œ∫(s,t)+iùêá{Œ∫(s,t)}\\kappa^*(s, t) = \\kappa(s, t) + \\mathbf{H}\\{\\kappa(s, t)\\} ii imaginary number. (Note hilbert function R Python returns full analytic signal, just imaginary component written ). complex number C=+ibC = + ib, magnitude denoted ||C||=[a2+b2]1/2||C|| = \\left[ ^2 + b^2 \\right]^{1/2} phase angle denoted ‚à†C=tan‚àí1(b/)\\angle C = \\tan^{-1} (b / ). One can also estimate analytic signal lateral excursion body z(s,t)z(s, t), zz lateral position point body, relative overall axis body. suggest using singular value decomposition estimate central body axis using low-pass filter cutoff frequency lower tail beat frequency remove tail beat oscillation, described . analytic signal thus provides estimate phase can estimated continuous function time position along body. techniques estimating phase require identifying particular features signal (peaks zero crossings) therefore estimate phase continuous signal. estimated phase œïÃÇ\\hat{\\phi} thus œïÃÇ(s,t)=‚à†Œ∫*(s,t).\\hat{\\phi}(s, t) = \\angle \\kappa^*(s, t). traveling wave, phase, estimated , equal argument cosine function traveling wave equation , œïÃÇ(s,t)=2œÄ[s/Œª‚àíft]\\hat{\\phi}(s, t) = 2\\pi [s/\\lambda - f t].","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"numerical-considerations-for-the-hilbert-transform","dir":"Articles","previous_headings":"Computing kinematic parameters > 5. Estimate phase","what":"Numerical considerations for the Hilbert transform","title":"fishmechr","text":"Hilbert transform works well analysis signals centered around zero consist many relatively smooth tailbeats. suggest using curvature Œ∫\\kappa, rather something like lateral position yy coordinate body. use Hilbert transform lateral position, important subtract baseline value use high pass filter ensure signal centered around zero. Similarly, signal noisy, phase œïÃÇ\\hat{\\phi} increase steadily derivatives used estimate fÃÇ\\hat{f} ŒªÃÇ\\hat{\\lambda} meaningful. best filter input signal using bandpass low pass filter oscillations smooth. programming languages, one use function atan2 estimate phase (atan), gives angle ranges around full circle (rather 0 180 degrees). However, output atan2 jump (usually œÄ\\pi ‚àíœÄ-\\pi) tt ss increase. estimate frequency wavelength, performing derivatives, one estimate smoothly increasing phase using function unwrap, searches jumps removes .","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"detect-peaks-and-zero-crossings","dir":"Articles","previous_headings":"Computing kinematic parameters > 5. Estimate phase","what":"Detect peaks and zero crossings","title":"fishmechr","text":"can also estimate phase detecting specific features oscillation, peaks zero crossings, interpolating continuous value phase using spline curve. cosine function, , positive peak phase œïÃÇ=0\\hat{\\phi} = 0, downward zero crossing phase œÄ/2\\pi/2, negative peak (.e., trough) phase œÄ\\pi, upward zero crossing phase 3œÄ/23\\pi/2. identifying features corresponding phases, one can interpolate continuous phase. Using method requires careful error checking. particular, peaks can identified erroneously, particularly noise signal. recommend using strong smoothing filter curvature lateral excursion estimating phase. See examples numerical details .","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"use-the-phase-to-estimate-frequency-and-wavelength","dir":"Articles","previous_headings":"Computing kinematic parameters","what":"6. Use the phase to estimate frequency and wavelength","title":"fishmechr","text":"can use estimated phase compute frequency wavelength taking derivatives time space, respectively, fÃÇ(t)=12œÄ‚àÇ‚àÇtœïÃÇ(s,t)\\hat{f}(t) = \\frac{1}{2\\pi} \\frac{\\partial}{\\partial t} \\hat{\\phi}(s,t) Estimated way, frequency every point along body. Therefore, can average fÃÇ\\hat{f} across body choose single point along body (usually tail) use estimate frequency. ŒªÃÇs(t)=2œÄ(‚àÇ‚àÇsœïÃÇ(s,t))‚àí1\\hat{\\lambda}_s(t) = 2 \\pi \\left( \\frac{\\partial}{\\partial s} \\hat{\\phi}(s,t) \\right)^{-1} body wave speed VÃÇ\\hat{V} product two: VÃÇ(t)=ŒªÃÇ(s,t)fÃÇ(t)\\hat{V}(t) = \\hat{\\lambda}(s, t) \\hat{f}(t)","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"quantify-swimming-parameters-on-a-cycle-by-cycle-basis","dir":"Articles","previous_headings":"Computing kinematic parameters","what":"7. Quantify swimming parameters on a cycle-by-cycle basis","title":"fishmechr","text":"estimated good undulation phase, straightforward quantify parameters vary every cycle. Usually, need define overall phase entire body oscillation. ‚Äôs best choose reliable phase estimate, usually phase tail tip point near tail (e.g., phiÃÇ(L,t)\\hat{phi}(L, t), LL body length). phase increases past 2œÄ2\\pi, jump back 0. programming languages functioned called unwrap looks jumps removes , producing steadily increasing phase, refer Œ¶ÃÇc(t)\\hat{\\Phi}_c(t). cycle number C(t)=‚åäŒ¶ÃÇc(t)/(2œÄ)‚åã C(t) = \\left\\lfloor\\hat{\\Phi}_c(t) / (2\\pi) \\right\\rfloor  L brackets denote floor operation, rounding next lowest integer value. example, find body amplitude, search within cycle find range motion body point, divide two. See details .","code":""},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"example-analysis-of-a-lamprey-data-set","dir":"Articles","previous_headings":"","what":"Example analysis of a lamprey data set","title":"fishmechr","text":"data set lampreydata included fishmechr package. swimming kinematics data sets similar structure: * time frame column. ‚Äôs often good keep data set. (, t frame) * column identifies point body. factor variable, names body part (like returned Sleap DeepLabCut), long clear order head tail. numeric variable, points numbered 1 nn, 1 snout nn tail. (point). * x y coordinates point. Currently, algorithms designed work 2D movements horizontal plane. (mxmm mymm, indicating ‚Äúmidline‚Äù x y points mm) plot shows midlines two frames.","code":"head(lampreydata) #>      t frame point mxmm mymm #> 1 0.02     1     1   NA   NA #> 2 0.02     1     2   NA   NA #> 3 0.02     1     3   NA   NA #> 4 0.02     1     4   NA   NA #> 5 0.02     1     5   NA   NA #> 6 0.02     1     6   NA   NA lampreydata |>    filter(frame %in% c(10, 20)) |>    mutate(frame = factor(frame)) |>    ggplot(aes(x = mxmm, mymm, color = frame, group = frame)) +   geom_path() +   coord_fixed()"},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"compute-arc-length-1","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Compute arc length","title":"fishmechr","text":"plot arc length points along body. can see ‚Äôre generally location, exactly, ‚Äôll need interpolate ‚Äôre place. ‚Äôs interpolation. Now points always arc length. Sometimes requires extrapolating get tail position.","code":"lampreydata <-   lampreydata |>    group_by(frame) |>   mutate(arclen0 = arclength(mxmm, mymm)) lampreydata |>    ungroup() |>    filter(point %in% c(5, 10, 18)) |>    ggplot(aes(x = t, y = arclen0, color = point)) +   geom_point() #> Warning: Removed 6 rows containing missing values or values outside the scale range #> (`geom_point()`). lampreydata <- lampreydata |>    interpolate_points_df(arclen0, mxmm, mymm, spar = 0.2,                         tailmethod = 'extrapolate',                         .out = c(arclen='arclen', xs='mxmm_s', ys='mymm_s')) lampreydata |>    filter(frame %in% c(10, 20)) |>    mutate(frame = factor(frame)) |>    ggplot(aes(x = mxmm, mymm, color = frame, group = frame)) +   geom_point(shape = 10) +   geom_path() +   geom_point(aes(x = mxmm_s, y = mymm_s), shape = 5) +   coord_fixed()"},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"get-the-width","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Get the width","title":"fishmechr","text":"digitized width ammocoete ventral view. assume width distance one lateral edge (like diameter), distance center edge (like radius). ‚Äôs expressed terms body lengths, along body width .","code":"fishwidth |>    ggplot(aes(x = s, y = ammowidth)) +   geom_path() +   labs(x = 'Arc length (BL)', y = 'Width (BL)') lampreydata <-   lampreydata |>    group_by(frame) |>    mutate(width = interpolate_width(fishwidth$s, fishwidth$ammowidth, arclen))"},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"compute-the-center-of-mass","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Compute the center of mass","title":"fishmechr","text":"","code":"lampreydata <-   lampreydata |>    get_midline_center_df(arclen0, mxmm_s,mymm_s, width=width) #> Estimating center of mass based on width  lampreydata |>    filter(frame %in% c(10, 20, 30, 40, 50)) |>    ggplot(aes(x = mxmm_s, y = mymm_s, color = frame)) +   geom_path(aes(group = frame)) +   geom_point(data = ~filter(.x, point == 1), aes(x = xcom, y = ycom)) +   coord_fixed()"},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"compute-curvature","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Compute curvature","title":"fishmechr","text":"computes curvature two different methods. Compare results. aren‚Äôt different, although ‚Äúxy‚Äù method gives slightly higher peaks. Plot curvature function time two different points along body. Hilbert analysis work well, close sinusoidal centered around 0.","code":"lampreydata <-   lampreydata |>    group_by(frame) |>    mutate(curve_ang = curvature(arclen0, mxmm_s, mymm_s),          curve_xy = curvature(arclen0, mxmm_s, mymm_s, method=\"xy\")) lampreydata |>    filter(frame %in% c(10, 20)) |>    mutate(frame = factor(frame)) |>    ggplot(aes(x = arclen0, color = frame, group = frame)) +   geom_path(aes(y = curve_ang), linetype='solid') +   geom_path(aes(y = curve_xy), linetype='dashed') #> Warning: Removed 4 rows containing missing values or values outside the scale range #> (`geom_path()`). #> Removed 4 rows containing missing values or values outside the scale range #> (`geom_path()`). lampreydata |>    filter(point %in% c(10, 18)) |>   mutate(point = factor(point)) |>    ggplot(aes(x = t, y = curve_ang, color = point)) +   geom_path() #> Warning: Removed 4 rows containing missing values or values outside the scale range #> (`geom_path()`)."},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"get-excursion","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Get excursion","title":"fishmechr","text":"extracts central swimming axis.  Similar curvature, can compute phases based lateral excursions (b). , need mostly sinusoidal centered around zero.","code":"lampreydata <- lampreydata |>    mutate(mxmm_ctr = mxmm_s - xcom,          mymm_ctr = mymm_s - ycom) |>    get_primary_swimming_axis_df(t, mxmm_ctr, mymm_ctr, .frame=frame) lampreydata |>    filter(frame %in% c(10, 20, 30)) |>    ggplot(aes(x = mxmm, y = mymm, color = frame)) +   geom_path(aes(group = frame)) +   geom_segment(data = ~ filter(.x, point == 20),                 aes(x = xcom, y = ycom,                     xend = xcom - 50*swimaxis_x,                     yend = ycom - 50*swimaxis_y)) +   geom_point(data = ~ filter(.x, point == 20),                 aes(x = xcom, y = ycom), color = 'red') +   facet_grid(frame ~ .) +   coord_fixed() lampreydata |>    filter(point %in% c(10, 18)) |>   mutate(point = factor(point)) |>    ggplot(aes(x = t, y = exc, color = point)) +   geom_path() #> Warning: Removed 4 rows containing missing values or values outside the scale range #> (`geom_path()`)."},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"phase","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Phase","title":"fishmechr","text":"Now compute phase body point oscillates time, looking either curvature curve_ang excursion b. hilbert_phase checks results gives warnings finds things might cause problems. * checks make sure input data NA. give warning input data NA, least data NA. * checks input signal seems oscillate around 0. * looks whether phase mostly advances time. cases phase seems run backwards, ‚Äôs often good indication data isn‚Äôt smoothed enough. case , warning point 2, close head, curvature tends quite low, can ignore warning. Compare two phase estimates. expect slopes , offset 2œÄ2\\pi places. solid lines phase based curvature dashed phase based excursion. Note curvature based phase (solid line) tends fluctuate lot point 3, near head curvature small.","code":"lampreydata <-   lampreydata |>    arrange(frame, desc(point)) |>    group_by(point) |>    mutate(ph_c = hilbert_phase(curve_ang),          ph_e = hilbert_phase(exc),          ph_p = peak_phase(exc)) #> Warning: There were 43 warnings in `mutate()`. #> The first warning was: #> ‚Ñπ In argument: `ph_c = hilbert_phase(curve_ang)`. #> ‚Ñπ In group 2: `point = 2`. #> Caused by warning in `hilbert_phase()`: #> ! Phase seems to go backwards a lot, which may indicate an overly noisy signal #> ‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 42 remaining warnings. lampreydata |>    ungroup() |>    filter(point %in% c(3, 8, 15, 18)) |>    mutate(point = factor(point)) |>    pivot_longer(cols = c(ph_c, ph_e, ph_p), names_to = \"method\", values_to = \"phase\") |>    ggplot(aes(x = t, y = phase, color = point, linetype = method)) +   geom_path() +    facet_wrap(~point) #> Warning: Removed 93 rows containing missing values or values outside the scale range #> (`geom_path()`)."},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"frequency","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Frequency","title":"fishmechr","text":"described , time derivative phase frequency. , can compute frequency point along body, although . # Body wavelength Body wavelength, described , derivative phase point along body respect arc length. Phase typically decreases along body, indicates backward traveling wave. apparent discontinuity ss = 50mm real. just reflects fact phase goes 00 2œÄ2\\pi wraps around back 0. get rid using unwrap function, applied across spatial dimension (equivalently, using group_by time frame number). phase across body discontinuities removed.","code":"lampreydata |>    group_by(point) |>    mutate(freq_c = get_frequency(t, ph_c, method='deriv'),          freq_e = get_frequency(t, ph_e, method='deriv'),          freq_p = get_frequency(t, ph_p, method='deriv')) |>    pivot_longer(cols = c(freq_c, freq_e, freq_p), names_to = \"method\", values_to = \"freq\") |>    filter(point %in% c(3, 15, 18)) |>    mutate(point = factor(point)) |>    ggplot(aes(x = t, y = freq, color = point, shape = method)) +   scale_shape_manual(values = c(1, 17, 22)) +   geom_point() +   facet_wrap(~point) #> Warning: There were 4 warnings in `mutate()`. #> The first warning was: #> ‚Ñπ In argument: `freq_c = get_frequency(t, ph_c, method = \"deriv\")`. #> ‚Ñπ In group 2: `point = 2`. #> Caused by warning in `get_frequency()`: #> ! Phase seems to go backwards a lot, which may indicate an overly noisy signal #> ‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 3 remaining warnings. #> Warning: Removed 79 rows containing missing values or values outside the scale range #> (`geom_point()`). lampreydata |>    filter(frame %in% c(60, 80)) |>    group_by(frame) |>    mutate(phbody = ph_p) |>   ggplot(aes(x = arclen, y = phbody, color = frame)) +   geom_path(aes(group = frame)) #> Warning: Removed 20 rows containing missing values or values outside the scale range #> (`geom_path()`). lampreydata |>    filter(frame %in% c(50, 60)) |>    group_by(frame) |>    mutate(phbody = gsignal::unwrap(ph_e)) |>   ggplot(aes(x = arclen, y = phbody, color = frame)) +   geom_path(aes(group = frame))"},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"methods-of-estimating-wavelength","dir":"Articles","previous_headings":"Example analysis of a lamprey data set","what":"Methods of estimating wavelength","title":"fishmechr","text":"several ways estimate body wavelength based body phase, different advantages disadvantages. function get_wavelength can run . point along body, can estimate derivative phase respect arc length. gives comprehensive results, , particular, makes fairly simple consider whether wavelength varies along body, also sensitive noise. can fit line data along body take slope line. method least sensitive noise, gives single value along entire body. can look distance along body phase changes full half cycle. look phase tail step backward along body find point ‚Äôs either full half cycle tail, distance represents full half wave, respectively. get_wavelength makes process accurate using simple linear interpolation find distance represents exactly 1 0.5 waves. phase tends poorly estimated body points anterior. get_wavelength allows specify formula ignore certain locations estimate. example single frame. ‚Äôre ignoring points less 30mm head. , can see methods give similar results, different numbers values different resolution along body. suggest ‚Äúhalfcycle‚Äù option good, relatively robust compromise. see wavelength estimated based curvature slightly noisier curvature based excursion, fluctuate time. plot shows wavelength function body position estimation method. curvature-based wavelengths seem increase along body (aside erroneous low values close tail), excursion-based wavelengths tend decrease moving toward tail.","code":"w <-   lampreydata |>    arrange(frame, arclen) |>    filter(frame %in% c(40)) |>    group_by(frame) |>    mutate(ph2 = gsignal::unwrap(ph_e),          wavelen_deriv = get_wavelength(arclen, ph2, method=\"deriv\",                                    ignore_arclen_vals = \\(s) s < 30),          wavelen_slope = get_wavelength(arclen, ph2, method=\"slope\",                                    ignore_arclen_vals = \\(s) s < 30),          wavelen_cycle = get_wavelength(arclen, ph2, method=\"cycle\",                                    ignore_arclen_vals = \\(s) s < 30,                                    sort_arclen = FALSE),          wavelen_halfcycle = get_wavelength(arclen, ph2, method=\"halfcycle\",                                    ignore_arclen_vals = \\(s) s < 30,                                    sort_arclen = TRUE)) w |>    pivot_longer(cols = contains(\"wavelen\"), names_to = \"method\", values_to = \"wavelen\") |>    ggplot(aes(x = arclen, y = wavelen, color = method, shape = method)) +   geom_point() #> Warning: Removed 41 rows containing missing values or values outside the scale range #> (`geom_point()`). lampreydata |>    arrange(frame, arclen) |>    group_by(frame) |>    mutate(phbody_e = gsignal::unwrap(ph_e),          phbody_c = gsignal::unwrap(ph_c),          wavelen_exc = get_wavelength(arclen, phbody_e, method=\"halfcycle\",                                     ignore_arclen_vals = \\(s) s < 30),          wavelen_curve = get_wavelength(arclen, phbody_c, method=\"halfcycle\",                                     ignore_arclen_vals = \\(s) s < 30)) |>    pivot_longer(cols = contains(\"wavelen\"), names_to = \"method\", values_to = \"wavelen\") |>    ggplot(aes(x = t)) +   geom_point(aes(y = wavelen, color = arclen, shape=method)) +   scale_shape_manual(values = c(15, 4)) #> Warning: Removed 2869 rows containing missing values or values outside the scale range #> (`geom_point()`). lampreydata |>    arrange(frame, arclen) |>    group_by(frame) |>    mutate(phbody_e = gsignal::unwrap(ph_e),          phbody_c = gsignal::unwrap(ph_c),          wavelen_exc = get_wavelength(arclen, phbody_e, method=\"halfcycle\",                                     ignore_arclen_vals = \\(s) s < 30),          wavelen_curve = get_wavelength(arclen, phbody_c, method=\"halfcycle\",                                     ignore_arclen_vals = \\(s) s < 30)) |>    pivot_longer(cols = contains(\"wavelen\"), names_to = \"method\", values_to = \"wavelen\") |>    ggplot(aes(x = arclen)) +   geom_point(aes(y = wavelen, color = arclen, shape=method)) +   scale_shape_manual(values = c(15, 4)) +   facet_wrap(~method) #> Warning: Removed 2869 rows containing missing values or values outside the scale range #> (`geom_point()`)."},{"path":"https://tytell.github.io/fishmechr/articles/fishmechr.html","id":"amplitude","dir":"Articles","previous_headings":"","what":"Amplitude","title":"fishmechr","text":"estimate amplitude, ‚Äôs helpful set overall cycle number whole body. define based excursion tail point. get_body_cycle_numbers also excludes partial cycles. Now, can use group_by cycles find cycle--cycle values. , look range excursion variable b. Half range amplitude, can define point body, four cycles present trial.","code":"lampreydata <-   lampreydata |>    get_body_cycle_numbers_df(ph_p, 20) |>    arrange(t, point)  lampreydata #> # A tibble: 1,600 √ó 24 #> # Groups:   point [20] #>        t frame point  mxmm  mymm arclen0 arclen mxmm_s mymm_s width  xcom  ycom #>    <dbl> <int> <int> <dbl> <dbl>   <dbl>  <dbl>  <dbl>  <dbl> <dbl> <dbl> <dbl> #>  1  0.02     1     1    NA    NA      NA   0        NA     NA  2.48    NA    NA #>  2  0.02     1     2    NA    NA      NA   8.13     NA     NA  2.61    NA    NA #>  3  0.02     1     3    NA    NA      NA  16.3      NA     NA  2.75    NA    NA #>  4  0.02     1     4    NA    NA      NA  24.4      NA     NA  2.81    NA    NA #>  5  0.02     1     5    NA    NA      NA  32.5      NA     NA  2.83    NA    NA #>  6  0.02     1     6    NA    NA      NA  40.7      NA     NA  2.85    NA    NA #>  7  0.02     1     7    NA    NA      NA  48.8      NA     NA  2.88    NA    NA #>  8  0.02     1     8    NA    NA      NA  56.9      NA     NA  2.80    NA    NA #>  9  0.02     1     9    NA    NA      NA  65.1      NA     NA  2.70    NA    NA #> 10  0.02     1    10    NA    NA      NA  73.2      NA     NA  2.61    NA    NA #> # ‚Ñπ 1,590 more rows #> # ‚Ñπ 12 more variables: curve_ang <dbl>, curve_xy <dbl>, mxmm_ctr <dbl>, #> #   mymm_ctr <dbl>, swimaxis_x <dbl>, swimaxis_y <dbl>, exc_x <dbl>, exc <dbl>, #> #   ph_c <dbl>, ph_e <dbl>, ph_p <dbl>, cycle <dbl> lampreydata |>    group_by(point, cycle) |>    summarize(amp = (max(exc) - min(exc)) / 2,             arclen = mean(arclen)) |>    ggplot(aes(x = arclen, y = amp, color = cycle)) +   geom_path(aes(group = cycle)) #> `summarise()` has grouped output by 'point'. You can override using the #> `.groups` argument. #> Warning: Removed 20 rows containing missing values or values outside the scale range #> (`geom_path()`)."},{"path":"https://tytell.github.io/fishmechr/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"First Last. Author, maintainer.","code":""},{"path":"https://tytell.github.io/fishmechr/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Last F (2024). fishmechr: Package (One Line, Title Case). R package version 0.0.0.9000, https://tytell.github.io/fishmechr/.","code":"@Manual{,   title = {fishmechr: What the Package Does (One Line, Title Case)},   author = {First Last},   year = {2024},   note = {R package version 0.0.0.9000},   url = {https://tytell.github.io/fishmechr/}, }"}]
